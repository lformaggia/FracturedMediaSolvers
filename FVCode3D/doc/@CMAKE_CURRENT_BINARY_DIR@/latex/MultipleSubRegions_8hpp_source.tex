\hypertarget{MultipleSubRegions_8hpp_source}{}\section{Multiple\+Sub\+Regions.\+hpp}
\label{MultipleSubRegions_8hpp_source}\index{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/multiple\+Sub\+Regions/\+Multiple\+Sub\+Regions.\+hpp@{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/multiple\+Sub\+Regions/\+Multiple\+Sub\+Regions.\+hpp}}

\begin{DoxyCode}
00001 
00006 \textcolor{preprocessor}{#ifndef MULTIPLESUBREGIONS\_HPP\_}
00007 \textcolor{preprocessor}{#define MULTIPLESUBREGIONS\_HPP\_}
00008 
00009 \textcolor{preprocessor}{#include <functional>}
00010 \textcolor{preprocessor}{#include <memory>}
00011 
00012 \textcolor{preprocessor}{#include <\hyperlink{RangeSupport_8hpp}{FVCode3D/eigenPatch/RangeSupport.hpp}>}
00013 \textcolor{preprocessor}{#include <\hyperlink{TypeDefinition_8hpp}{FVCode3D/core/TypeDefinition.hpp}>}
00014 \textcolor{preprocessor}{#include <\hyperlink{Data_8hpp}{FVCode3D/core/Data.hpp}>}
00015 
00016 \textcolor{keyword}{namespace }\hyperlink{namespaceFVCode3D}{FVCode3D}
00017 \{
00018 
00020 
00027 \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} \hyperlink{namespaceFVCode3D_ae0b3b38fc8dff58445ba3d625deae285}{linearRegionSelection} ( \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}& \_cellSolution, \textcolor{keyword}{const} 
      \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}& \_nbRegions,
00028                              \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}& \_minSolution = 0, \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}& \_maxSolution = 0 );
00029 
00031 
00036 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00037}{}\hyperlink{classFVCode3D_1_1MSR}{00037} \textcolor{keyword}{class }\hyperlink{classFVCode3D_1_1MSR}{MSR}
00038 \{
00039 \textcolor{keyword}{public}:
00040 
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00041}{}\hyperlink{classFVCode3D_1_1MSR_aee0f8176a894e4f695baa08af10d14cf}{00041}     \textcolor{keyword}{typedef} ProblemType \hyperlink{classFVCode3D_1_1MSR_aee0f8176a894e4f695baa08af10d14cf}{problem\_Type};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00042}{}\hyperlink{classFVCode3D_1_1MSR_a88e19436275c5ca4ed6629c2a3bb8480}{00042}     \textcolor{keyword}{typedef} \hyperlink{classFVCode3D_1_1MSR}{MSR<problem\_Type>} \hyperlink{classFVCode3D_1_1MSR_a88e19436275c5ca4ed6629c2a3bb8480}{class\_Type};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00043}{}\hyperlink{classFVCode3D_1_1MSR_aebe9d4e9bbcc367d79b0aae7b794c5a6}{00043}     \textcolor{keyword}{typedef} std::function<UInt(const Real&, const UInt&, const Real&, const Real& )> 
      \hyperlink{classFVCode3D_1_1MSR_aebe9d4e9bbcc367d79b0aae7b794c5a6}{regionFct\_Type};
00044 
00046 
00047 
00049     \hyperlink{classFVCode3D_1_1MSR_afde22943dde9de3aa2f2eec71207201f}{MSR}() = \textcolor{keyword}{delete};
00050 
00052 
00056     \hyperlink{classFVCode3D_1_1MSR_afde22943dde9de3aa2f2eec71207201f}{MSR}(ProblemType* problem, \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a3d19a370a98afe491a9e17a646a9c56f}{DataPtr\_Type}& data);
00057 
00059     \hyperlink{classFVCode3D_1_1MSR_ae08f2baa5cdfc35c42b2617b9308b09f}{~MSR}() = \textcolor{keywordflow}{default};
00060 
00062 
00064 
00065 
00067 
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00070}{}\hyperlink{classFVCode3D_1_1MSR_a45eca62b8bdf376a08c668b1535ac275}{00070}     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a9c3dcef0872c1dbd4aaf770d08421fd7}{UIntVector}& \hyperlink{classFVCode3D_1_1MSR_a45eca62b8bdf376a08c668b1535ac275}{getColorsVector}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} 
      \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}; \}
00071 
00073 
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00076}{}\hyperlink{classFVCode3D_1_1MSR_a9ec80ddf6aa0e39f5b7ac338cac71904}{00076}     \textcolor{keyword}{const} std::vector<Real>& \hyperlink{classFVCode3D_1_1MSR_a9ec80ddf6aa0e39f5b7ac338cac71904}{getTransmissibility}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} 
      \hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{M\_transmissibilities}; \}
00077 
00079 
00081 
00082 
00084     \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_aea841370ef1133a635c885714670abec}{setup}();
00085 
00087 
00090     \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_af28b461584648e7d01bc515944ff42e8}{createRegions}(\textcolor{keyword}{const} regionFct\_Type& \_regionFct = 
      \hyperlink{namespaceFVCode3D_ae0b3b38fc8dff58445ba3d625deae285}{linearRegionSelection});
00091 
00093 
00096     \textcolor{keywordtype}{bool} \hyperlink{classFVCode3D_1_1MSR_ae05006ec34d2e773279b4a3028e08d21}{isPseudoSteadyState}(\textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a16ccf345652402bccd1a5d2e6782526c}{Vector}& \_oldSolution);
00097 
00099 
00102     \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_a86a998e349b36dbbef9300b15653afc2}{computeTransmissibility}();
00103 
00105 
00106 \textcolor{keyword}{private}:
00107 
00109     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_afc43a5ff2dc8f0dce321aa3d03b45194}{computeDeltaPressure}();
00110 
00112 
00116     \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_a6425feaf241a89b4be13bab2e83c8b2e}{computeAveragePressure}(std::vector<Real>& \_averagePressure) \textcolor{keyword}{const};
00117 
00119 
00123     \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_ae29570a0d0d6767454ebf70f97e22f47}{computeFlux}(std::vector<Real>& flux) \textcolor{keyword}{const};
00124 
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00126}{}\hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{00126}     problem\_Type* \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00128}{}\hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{00128}     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a3d19a370a98afe491a9e17a646a9c56f}{DataPtr\_Type}& \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data};
00129 
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00131}{}\hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{00131}     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} \hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{M\_dofTotal};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00133}{}\hyperlink{classFVCode3D_1_1MSR_ae96e6d741dd194e8be925062759acbc9}{00133}     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} \hyperlink{classFVCode3D_1_1MSR_ae96e6d741dd194e8be925062759acbc9}{M\_dofFractures};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00135}{}\hyperlink{classFVCode3D_1_1MSR_a04c41dbcba341c70158af3db7b69916e}{00135}     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} \hyperlink{classFVCode3D_1_1MSR_a04c41dbcba341c70158af3db7b69916e}{M\_dofPorousMatrix};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00137}{}\hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{00137}     \hyperlink{namespaceFVCode3D_a9c3dcef0872c1dbd4aaf770d08421fd7}{UIntVector} \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00139}{}\hyperlink{classFVCode3D_1_1MSR_a292e038fb48f7f4f39238d375ea6f6e0}{00139}     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} \hyperlink{classFVCode3D_1_1MSR_a292e038fb48f7f4f39238d375ea6f6e0}{M\_maxSolution};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00141}{}\hyperlink{classFVCode3D_1_1MSR_a6e8eb6a0513e4b46241950b8ee2b7212}{00141}     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} \hyperlink{classFVCode3D_1_1MSR_a6e8eb6a0513e4b46241950b8ee2b7212}{M\_minSolution};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00143}{}\hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{00143}     \textcolor{keywordtype}{bool} \hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{M\_isPseudoSteadyState};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00145}{}\hyperlink{classFVCode3D_1_1MSR_a481d90b7ea3b6d1f3f818f811e58a9a3}{00145}     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} \hyperlink{classFVCode3D_1_1MSR_a481d90b7ea3b6d1f3f818f811e58a9a3}{M\_localNbTimeStepSteadyState};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00147}{}\hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{00147}     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} \hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{M\_constantValue};
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00149}{}\hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{00149}     std::vector<Real> \hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{M\_transmissibilities};
00150 \}; \textcolor{comment}{// class MSR}
00151 
00152 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00153}{}\hyperlink{classFVCode3D_1_1MSR_adf51f6d947efdd20fc55e28e32f03178}{00153} \hyperlink{classFVCode3D_1_1MSR_afde22943dde9de3aa2f2eec71207201f}{MSR<ProblemType>::MSR}(ProblemType* problem, \textcolor{keyword}{const} 
      \hyperlink{namespaceFVCode3D_a3d19a370a98afe491a9e17a646a9c56f}{DataPtr\_Type}& data ):
00154     \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}( problem ),
00155     \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}( data ),
00156     \hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{M\_dofTotal}( 0 ),
00157     \hyperlink{classFVCode3D_1_1MSR_ae96e6d741dd194e8be925062759acbc9}{M\_dofFractures}( 0 ),
00158     \hyperlink{classFVCode3D_1_1MSR_a04c41dbcba341c70158af3db7b69916e}{M\_dofPorousMatrix}( 0 ),
00159     \hyperlink{classFVCode3D_1_1MSR_a292e038fb48f7f4f39238d375ea6f6e0}{M\_maxSolution}( \hyperlink{namespacestd}{std}::numeric\_limits<\hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}>::lowest() ),
00160     \hyperlink{classFVCode3D_1_1MSR_a6e8eb6a0513e4b46241950b8ee2b7212}{M\_minSolution}( \hyperlink{namespacestd}{std}::numeric\_limits<\hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}>::max() ),
00161     \hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{M\_isPseudoSteadyState}(false),
00162     \hyperlink{classFVCode3D_1_1MSR_a481d90b7ea3b6d1f3f818f811e58a9a3}{M\_localNbTimeStepSteadyState}(0),
00163     \hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{M\_constantValue}( \hyperlink{namespacestd}{std}::numeric\_limits<\hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}>::lowest() )
00164 \{\} \textcolor{comment}{// MSR::MSR}
00165 
00166 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00167}{}\hyperlink{classFVCode3D_1_1MSR_aea841370ef1133a635c885714670abec}{00167} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_aea841370ef1133a635c885714670abec}{MSR<ProblemType>::setup}()
00168 \{
00169     \hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{M\_dofTotal} = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getA().outerSize();
00170     \hyperlink{classFVCode3D_1_1MSR_ae96e6d741dd194e8be925062759acbc9}{M\_dofFractures} = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getMesh().getFractureFacetsIdsVector().size();
00171     \hyperlink{classFVCode3D_1_1MSR_a04c41dbcba341c70158af3db7b69916e}{M\_dofPorousMatrix} = \hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{M\_dofTotal} - \hyperlink{classFVCode3D_1_1MSR_ae96e6d741dd194e8be925062759acbc9}{M\_dofFractures};
00172     \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions} = UIntVector::Zero( \hyperlink{classFVCode3D_1_1MSR_a52fc7223f5d641543781b1224e686610}{M\_dofTotal} );
00173 \} \textcolor{comment}{// MSR::setup}
00174 
00175 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00176}{}\hyperlink{classFVCode3D_1_1MSR_af28b461584648e7d01bc515944ff42e8}{00176} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_af28b461584648e7d01bc515944ff42e8}{MSR<ProblemType>::createRegions}( \textcolor{keyword}{const} 
      \hyperlink{classFVCode3D_1_1MSR_aebe9d4e9bbcc367d79b0aae7b794c5a6}{regionFct\_Type}& \_regionFct )
00177 \{
00178     \hyperlink{classFVCode3D_1_1MSR_afc43a5ff2dc8f0dce321aa3d03b45194}{computeDeltaPressure}();
00179 
00180     \textcolor{keyword}{using namespace }std::placeholders;
00181     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nbSubRegions = \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}->nbSubRegions();
00182     \textcolor{keyword}{const} \textcolor{keyword}{auto} fc\_region = std::bind( \_regionFct, \_1, nbSubRegions, 
      \hyperlink{classFVCode3D_1_1MSR_a6e8eb6a0513e4b46241950b8ee2b7212}{M\_minSolution}, \hyperlink{classFVCode3D_1_1MSR_a292e038fb48f7f4f39238d375ea6f6e0}{M\_maxSolution} );
00183 
00184     \textcolor{keywordtype}{size\_t} index = 0;
00185     \textcolor{keyword}{const} \textcolor{keyword}{auto} & solution = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getSolver().getSolution();
00186     \textcolor{keyword}{auto} apply\_sub\_region = [&] ( \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}& value )\{ value = fc\_region( solution[ index ] ); ++index; \};
00187 
00188     std::for\_each( \hyperlink{namespacestd_acec9a198880c12f51f02be95a298a48b}{std::begin}( \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions} ), 
      \hyperlink{namespacestd_aeb4b319cf9afda99ba1f47d32df15bc9}{std::end}( \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions} ), apply\_sub\_region );
00189 \} \textcolor{comment}{// MSR::createRegions}
00190 
00191 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00192}{}\hyperlink{classFVCode3D_1_1MSR_afc43a5ff2dc8f0dce321aa3d03b45194}{00192} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_afc43a5ff2dc8f0dce321aa3d03b45194}{MSR<ProblemType>::computeDeltaPressure}()
00193 \{
00194     \textcolor{keyword}{const} \textcolor{keyword}{auto} & solution = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getSolver().getSolution();
00195 
00196     \hyperlink{classFVCode3D_1_1MSR_a292e038fb48f7f4f39238d375ea6f6e0}{M\_maxSolution} = *std::max\_element( \hyperlink{namespacestd_acec9a198880c12f51f02be95a298a48b}{std::begin}( solution ), 
      \hyperlink{namespacestd_aeb4b319cf9afda99ba1f47d32df15bc9}{std::end}( solution ) );
00197     \hyperlink{classFVCode3D_1_1MSR_a6e8eb6a0513e4b46241950b8ee2b7212}{M\_minSolution} = *std::min\_element( \hyperlink{namespacestd_acec9a198880c12f51f02be95a298a48b}{std::begin}( solution ), 
      \hyperlink{namespacestd_aeb4b319cf9afda99ba1f47d32df15bc9}{std::end}( solution ) );
00198 \} \textcolor{comment}{// MSR::computeDeltaPressure}
00199 
00200 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00201}{}\hyperlink{classFVCode3D_1_1MSR_ae05006ec34d2e773279b4a3028e08d21}{00201} \textcolor{keywordtype}{bool} \hyperlink{classFVCode3D_1_1MSR_ae05006ec34d2e773279b4a3028e08d21}{MSR<ProblemType>::isPseudoSteadyState}(\textcolor{keyword}{const} 
      \hyperlink{namespaceFVCode3D_a16ccf345652402bccd1a5d2e6782526c}{Vector}& \_oldSolution )
00202 \{
00203     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a16ccf345652402bccd1a5d2e6782526c}{Vector}& solution = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getSolver().getSolution();
00204     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} currentConstantValue = ( solution - \_oldSolution ).norm() / 
      \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}->getTimeStep();
00205     \hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{M\_isPseudoSteadyState} = ( currentConstantValue - 
      \hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{M\_constantValue} ) < \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}->tolSteadyState();
00206     \hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{M\_constantValue} = currentConstantValue;
00207     \hyperlink{classFVCode3D_1_1MSR_a481d90b7ea3b6d1f3f818f811e58a9a3}{M\_localNbTimeStepSteadyState}++;
00208 
00209     std::cout << \textcolor{stringliteral}{" currentConstantValue "} << currentConstantValue << std::endl;
00210     std::cout << \textcolor{stringliteral}{" diff "} << currentConstantValue - \hyperlink{classFVCode3D_1_1MSR_ae1152dcd118f020c5cd9fefe4eafd5e4}{M\_constantValue} << std::endl;
00211     std::cout << \textcolor{stringliteral}{" M\_isPseudoSteadyState "} << \hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{M\_isPseudoSteadyState} << std::endl;
00212 
00213     \textcolor{keywordflow}{return} ( \hyperlink{classFVCode3D_1_1MSR_aa4276f60467226b5aae9e12c024701f6}{M\_isPseudoSteadyState} && 
      \hyperlink{classFVCode3D_1_1MSR_a481d90b7ea3b6d1f3f818f811e58a9a3}{M\_localNbTimeStepSteadyState} >= \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}->nbTimeStepSteadyState() );
00214 \} \textcolor{comment}{// MSR::isPseudoSteadyState}
00215 
00216 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00217}{}\hyperlink{classFVCode3D_1_1MSR_a86a998e349b36dbbef9300b15653afc2}{00217} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_a86a998e349b36dbbef9300b15653afc2}{MSR<ProblemType>::computeTransmissibility}()
00218 \{
00219     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nbSubRegions = \hyperlink{classFVCode3D_1_1MSR_a03e013e5191655455e66563e815f262b}{M\_data}->nbSubRegions();
00220     std::vector<Real> averagePressure( nbSubRegions + 1, 0. ), flux( nbSubRegions, 0. );
00221     \hyperlink{classFVCode3D_1_1MSR_a6425feaf241a89b4be13bab2e83c8b2e}{computeAveragePressure}( averagePressure );
00222     \hyperlink{classFVCode3D_1_1MSR_ae29570a0d0d6767454ebf70f97e22f47}{computeFlux}( flux );
00223 
00224     \hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{M\_transmissibilities}.resize( nbSubRegions );
00225     \textcolor{keywordflow}{for} ( \textcolor{keywordtype}{size\_t} i = 0; i < \hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{M\_transmissibilities}.size(); ++i )
00226     \{
00227         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} deltaPressure = std::fabs ( averagePressure[ i + 1 ] - averagePressure[ i ] );
00228         \hyperlink{classFVCode3D_1_1MSR_abcb3d099c26d9747b02231cb0d3b7bb3}{M\_transmissibilities}[ i ] = flux[ i ] / deltaPressure;
00229     \} \textcolor{comment}{// for}
00230 \} \textcolor{comment}{// MSR::computeTransmissibility}
00231 
00232 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00233}{}\hyperlink{classFVCode3D_1_1MSR_a6425feaf241a89b4be13bab2e83c8b2e}{00233} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_a6425feaf241a89b4be13bab2e83c8b2e}{MSR<ProblemType>::computeAveragePressure}( std::vector<Real> & 
      \_averagePressure )\textcolor{keyword}{ const}
00234 \textcolor{keyword}{}\{
00235     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a16ccf345652402bccd1a5d2e6782526c}{Vector}& solution = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getSolver().getSolution();
00236     \textcolor{keyword}{const} \textcolor{keyword}{auto}& properties = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getMesh().getPropertiesMap();
00237     \textcolor{keyword}{const} \textcolor{keyword}{auto}& cellsVector = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getMesh().getCellsVector();
00238     \textcolor{keyword}{const} \textcolor{keyword}{auto}& cellsFault = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getMesh().getFractureFacetsIdsVector();
00239     std::vector<Real> measures( \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}.size(), 0. );
00240     std::vector<Real> area( \_averagePressure.size(), 0. );
00241 
00242     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& cell\_it : cellsVector )
00243     \{
00244         measures[ cell\_it.getId() ] = cell\_it.getVolume();
00245     \} \textcolor{comment}{// for}
00246 
00247     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& facet\_it : cellsFault )
00248     \{
00249         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} localMeasure = properties.getProperties( facet\_it.getZoneCode() ).M\_aperture
00250                                   * facet\_it.getFacet().area();
00251         measures[ facet\_it.getIdAsCell() ] = localMeasure;
00252         \textcolor{keyword}{const} \textcolor{keyword}{auto}& neighborCells = facet\_it.getSeparatedCellsIds();
00253         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& cell\_it : neighborCells )
00254         \{
00255             measures[ cell\_it ] -= localMeasure / 2.;
00256         \} \textcolor{comment}{// for}
00257     \} \textcolor{comment}{// for}
00258 
00259     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < static\_cast<size\_t>(\hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}.size()); ++i )
00260     \{
00261         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} regionId = \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}[ i ];
00262         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} cellMeasure = measures[ i ];
00263         \_averagePressure[ regionId ] += solution[ i ] * cellMeasure;
00264         area[ regionId ] += cellMeasure;
00265     \} \textcolor{comment}{// for}
00266 
00267     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < \_averagePressure.size(); ++i )
00268     \{
00269         \_averagePressure[ i ] /= area[ i ];
00270     \} \textcolor{comment}{// for}
00271 \} \textcolor{comment}{// MSR::computeAveragePressure}
00272 
00273 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ProblemType>
\hypertarget{MultipleSubRegions_8hpp_source.tex_l00274}{}\hyperlink{classFVCode3D_1_1MSR_ae29570a0d0d6767454ebf70f97e22f47}{00274} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1MSR_ae29570a0d0d6767454ebf70f97e22f47}{MSR<ProblemType>::computeFlux}( std::vector<Real> & \_flux )\textcolor{keyword}{ const}
00275 \textcolor{keyword}{}\{
00276     \textcolor{keyword}{const} \textcolor{keyword}{auto}& solution = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getSolver().getSolution();
00277     \textcolor{keyword}{const} \textcolor{keyword}{auto}& mesh = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getMesh();
00278     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& facet\_it : mesh.getInternalFacetsIdsVector() )
00279     \{
00280         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} neighborCell0 = facet\_it.getSeparatedCellsIds()[0];
00281         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} neighborCell1 = facet\_it.getSeparatedCellsIds()[1];
00282         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} colorCell0 = \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}[ neighborCell0 ];
00283         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} colorCell1 = \hyperlink{classFVCode3D_1_1MSR_a38cba0138e4ebd055d47b3d9d9d32623}{M\_multipleSubRegions}[ neighborCell1 ];
00284         \textcolor{keywordflow}{if} ( colorCell0 != colorCell1 )
00285         \{
00286             assert( std::abs( static\_cast<Int>( colorCell0 - colorCell1 ) ) == 1 );
00287             \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} deltaSolution = std::fabs ( solution[ neighborCell0 ] - solution[ neighborCell1 
      ] );
00288             \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} transmissibility = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getA().coeffRef( neighborCell0, 
      neighborCell1 );
00289             \_flux[ std::min( colorCell0, colorCell1 ) ] += transmissibility * deltaSolution;
00290         \} \textcolor{comment}{// if}
00291     \} \textcolor{comment}{// for}
00292 
00293     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& facet\_it : mesh.getFractureFacetsIdsVector() )
00294     \{
00295         \textcolor{keyword}{const} \textcolor{keyword}{auto}& neighborCells = facet\_it.getSeparatedCellsIds();
00296         \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} facetIdasCell = facet\_it.getIdAsCell();
00297         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}& cell\_it : neighborCells )
00298         \{
00299             \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} transmissibility = \hyperlink{classFVCode3D_1_1MSR_a531760a5415f63b7be6087ab117031e5}{M\_problem}->getA().coeffRef( cell\_it, facetIdasCell )
      ;
00300             \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} deltaSolution = std::fabs ( solution[ cell\_it ] - solution[ facetIdasCell ] );
00301             \_flux[ 0 ] += transmissibility * deltaSolution;
00302         \} \textcolor{comment}{// for}
00303     \} \textcolor{comment}{// for}
00304 \} \textcolor{comment}{// MSR::computeFlux}
00305 
00306 \} \textcolor{comment}{// namespace FVCode3D}
00307 
00308 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* MULTIPLESUBREGIONS\_HPP\_ */}\textcolor{preprocessor}{}
\end{DoxyCode}
