\hypertarget{Import_8cpp_source}{}\section{Import.\+cpp}
\label{Import_8cpp_source}\index{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/import/\+Import.\+cpp@{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/import/\+Import.\+cpp}}

\begin{DoxyCode}
00001 
00006 \textcolor{preprocessor}{#include <\hyperlink{Mesh3D_8hpp}{FVCode3D/mesh/Mesh3D.hpp}>}
00007 \textcolor{preprocessor}{#include <\hyperlink{Properties_8hpp}{FVCode3D/property/Properties.hpp}>}
00008 \textcolor{preprocessor}{#include <\hyperlink{Import_8hpp}{FVCode3D/import/Import.hpp}>}
00009 \textcolor{preprocessor}{#include <\hyperlink{Permeability_8hpp}{FVCode3D/property/Permeability.hpp}>}
00010 \textcolor{preprocessor}{#include <\hyperlink{StringManipolator_8hpp}{FVCode3D/utility/StringManipolator.hpp}>}
00011 
00012 \textcolor{preprocessor}{#include <utility>}
00013 \textcolor{preprocessor}{#include <map>}
00014 \textcolor{preprocessor}{#include <random>}
00015 \textcolor{preprocessor}{#include <locale>}
00016 
00017 \textcolor{keyword}{namespace }\hyperlink{namespaceFVCode3D}{FVCode3D}
00018 \{
00019 
\hypertarget{Import_8cpp_source.tex_l00020}{}\hyperlink{classFVCode3D_1_1Importer_a1cba26ff3b2c475a51866361883c59fc}{00020} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1Importer_a1cba26ff3b2c475a51866361883c59fc}{Importer::extractBC}(\textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} theta)
00021 \{
00022     \hyperlink{classFVCode3D_1_1Point3D}{Point3D} normal, center, centerFace;
00023     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} max;
00024     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} compMax;
00025 
00026     \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Facet3D>::iterator it = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().begin(); it 
      != \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().end(); ++it)
00027     \{
00028         \textcolor{keywordflow}{if} (it->second.getSeparatedCells().size() == 1)
00029         \{
00030             center = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}().at(*(it->second.getSeparatedCells().begin())).
      getCentroid();
00031             centerFace = it->second.getCentroid();
00032 
00033             normal = it->second.getUnsignedNormal();
00034             center -= centerFace;
00035             center.\hyperlink{classFVCode3D_1_1Point3D_a0d1cd3d114b0985ae2b11cd1c52de673}{normalize}();
00036 
00037             \textcolor{keywordflow}{if}(normal * center > 0.)
00038                 normal = -normal;
00039 
00040             normal = \hyperlink{namespaceFVCode3D_aefa056e4f7c5d10edd993b812dd670da}{rotateOf}(normal, theta);
00041 
00042             max = std::max(std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_ae015d6aa31f8b304f69696bdcbd4da19}{x}()), std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a950abcabbf3bb32fc2daf64c28d77416}{y}()));
00043             compMax = std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_ae015d6aa31f8b304f69696bdcbd4da19}{x}()) > std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a950abcabbf3bb32fc2daf64c28d77416}{y}()) ? 0 : 1;
00044 
00045             max = std::max(max, std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a865109e2006cc1de3681ab601081f5aa}{z}()));
00046             compMax = max > std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a865109e2006cc1de3681ab601081f5aa}{z}()) ? compMax : 2;
00047 
00048             \textcolor{keywordflow}{if}(normal[compMax]<0.)
00049                 it->second.setBorderID(2*compMax+1);
00050             \textcolor{keywordflow}{else}
00051                 it->second.setBorderID(2*compMax+2);
00052         \}
00053     \}
00054 \}
00055 
\hypertarget{Import_8cpp_source.tex_l00056}{}\hyperlink{classFVCode3D_1_1Importer_ac3c29fd7bbccef4ae39ce8d0b63b789f}{00056} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1Importer_ac3c29fd7bbccef4ae39ce8d0b63b789f}{Importer::addFractures}()
00057 \{
00058     \hyperlink{classFVCode3D_1_1FractureNetwork3D}{FractureNetwork3D} FN(\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh});
00059     std::vector<Fracture3D> fracturesVector;
00060     std::map<UInt, Fracture3D> fracturesMap;
00061     std::map<UInt, Fracture3D>::iterator itF;
00062     \hyperlink{classFVCode3D_1_1Point3D}{Point3D} normal, center, centerFace;
00063 
00064     \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Facet3D>::iterator it = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().begin(); it 
      != \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().end(); ++it)
00065     \{
00066         \textcolor{keywordflow}{if} (it->second.getZoneCode() > 0 && it->second.getBorderId()==0)
00067         \{
00068             itF = fracturesMap.find(it->second.getZoneCode());
00069             \textcolor{keywordflow}{if} (itF != fracturesMap.end())
00070                 itF->second.push\_back(it->first);
00071             \textcolor{keywordflow}{else}
00072             \{
00073                 fracturesMap.emplace(std::piecewise\_construct, std::forward\_as\_tuple(it->second.getZoneCode
      ()), std::forward\_as\_tuple(\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}) );
00074                 fracturesMap.at(it->second.getZoneCode()).push\_back(it->first);
00075                 fracturesMap.at(it->second.getZoneCode()).getId() = it->second.getZoneCode();
00076             \}
00077         \}
00078     \}
00079 
00080     fracturesVector.reserve(fracturesMap.size());
00081     \textcolor{keywordflow}{for}(itF = fracturesMap.begin();  itF != fracturesMap.end(); ++itF)
00082         fracturesVector.push\_back(itF->second);
00083 
00084     FN.\hyperlink{classFVCode3D_1_1FractureNetwork3D_a1d1ae862d9076988686cef213dc0574d}{addFractures}(fracturesVector);
00085 
00086     \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a269c01796091da2f599e66b6b91b39dd}{addFractureNetwork}(FN);
00087 \}
00088 
\hypertarget{Import_8cpp_source.tex_l00089}{}\hyperlink{classFVCode3D_1_1Importer_ac21d82671c21b2e4069511ef0585d7f6}{00089} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1Importer_ac21d82671c21b2e4069511ef0585d7f6}{Importer::addBCAndFractures}(\textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} theta)
00090 \{
00091     \hyperlink{classFVCode3D_1_1Importer_a1cba26ff3b2c475a51866361883c59fc}{extractBC}(theta);
00092     \hyperlink{classFVCode3D_1_1Importer_ac3c29fd7bbccef4ae39ce8d0b63b789f}{addFractures}();
00093 \}
00094 
\hypertarget{Import_8cpp_source.tex_l00095}{}\hyperlink{classFVCode3D_1_1ImporterMedit_a588447299960ebaf2f7583fe2ddecdcc}{00095} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1ImporterMedit_a588447299960ebaf2f7583fe2ddecdcc}{ImporterMedit::import}(\textcolor{keywordtype}{bool} fracturesOn) \textcolor{keywordflow}{throw}()
00096 \{
00097     std::ifstream file;
00098     file.open(\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename}.c\_str(), std::ios\_base::in);
00099     \textcolor{keywordflow}{if}(!file)
00100     \{
00101         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing Medit mesh."});
00102     \}
00103 
00104     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes, nFacets, nCells;
00105     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} zone, maxZone, bcId;
00106     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i, j;
00107     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} x, y, z;
00108     std::vector<UInt> tmp, tmpNodes(3), tmpFacets(4);
00109     std::set<UInt> zones;
00110     std::string buffer = \textcolor{stringliteral}{""};
00111 
00112     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00113     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00114     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00115 
00116     \hyperlink{classFVCode3D_1_1Properties}{Properties} prop;
00117 
00118     \textcolor{comment}{// Read nodes}
00119     \textcolor{keyword}{const} std::string s2findN = \textcolor{stringliteral}{"Vertices"};
00120     \textcolor{keywordflow}{while}(buffer!=s2findN)
00121         getline(file, buffer);
00122 
00123     file >> nNodes;
00124     nodesRef.reserve(nNodes);
00125 
00126     \textcolor{keywordflow}{for}(i=0; i < nNodes; ++i)
00127     \{
00128         file >> x; file >> y; file >> z;
00129         file >> buffer;
00130         nodesRef.emplace\_back(x,y,z); \textcolor{comment}{// Point3D}
00131     \}
00132 
00133     \textcolor{comment}{// Read facets}
00134     \textcolor{keyword}{const} std::string s2findT = \textcolor{stringliteral}{"Triangles"};
00135     \textcolor{keywordflow}{while}(buffer!=s2findT)
00136         getline(file, buffer);
00137 
00138     file >> nFacets;
00139 
00140     std::shared\_ptr<PermeabilityScalar> permPtr(\textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00141     permPtr->setPermeability(1. , 0);
00142 
00143     tmp.resize(3);
00144     \textcolor{keywordflow}{for}(i=0; i < nFacets; ++i)
00145     \{
00146         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < 3; ++j)
00147         \{
00148             file >> tmp[j];
00149             tmp[j]--;
00150         \}
00151         file >> zone;
00152         bcId = (zone <= 1000 && zone > 0) ? 1 : 0;
00153         zone = (zone > 1000) && (zone <= 2000) ? zone : 0;
00154         facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, (zone)*static\_cast<UInt>(fracturesOn), bcId) );
00155         \textcolor{keywordflow}{if}(zone > 1 && fracturesOn && zones.find(zone) == zones.end())
00156         \{
00157             prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00158             \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(zone, prop);
00159             zones.insert(zone);
00160         \}
00161     \}
00162     tmp.clear();
00163 
00164     \textcolor{comment}{// Read cells}
00165     \textcolor{keyword}{const} std::string s2findE = \textcolor{stringliteral}{"Tetrahedra"};
00166     \textcolor{keywordflow}{while}(buffer!=s2findE)
00167         getline(file, buffer);
00168 
00169     file >> nCells;
00170 
00171     maxZone = (zones.size() > 0) ? *std::max\_element(zones.begin(), zones.end()) : 0;
00172     prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00173     \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(maxZone+1, prop);
00174 
00175     \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a609f980329f5a98e9fad724049e509d2}{buildNodesToFacetMap}();
00176 
00177     tmp.resize(4);
00178     \textcolor{keywordflow}{for}(i=0; i < nCells; ++i)
00179     \{
00180         \textcolor{comment}{// get the nodes that define the cell}
00181         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < 4; ++j)
00182         \{
00183             file >> tmp[j];
00184             tmp[j]--;
00185         \}
00186         file >> buffer;
00187 
00188         \textcolor{comment}{// costruisco le facce della cella partendo dai nodi}
00189         \textcolor{keywordflow}{for}(j=0; j < 4; ++j)
00190         \{
00191             tmpNodes[0] = tmp[j % 4];
00192             tmpNodes[1] = tmp[(j+1) % 4];
00193             tmpNodes[2] = tmp[(j+2) % 4];
00194             tmpFacets[j] = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmpNodes);
00195         \}
00196 
00197         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmpFacets, maxZone+1) );
00198     \}
00199     tmp.clear();
00200 
00201     file.close();
00202 \}
00203 
\hypertarget{Import_8cpp_source.tex_l00204}{}\hyperlink{classFVCode3D_1_1ImporterTetGen_a37d0191b42bbb7af28f5c42acb1185b7}{00204} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1ImporterTetGen_a37d0191b42bbb7af28f5c42acb1185b7}{ImporterTetGen::import}(\textcolor{keywordtype}{bool} fracturesOn) \textcolor{keywordflow}{throw}()
00205 \{
00206     std::ifstream file;
00207     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".node"}).c\_str(), std::ios\_base::in);
00208     \textcolor{keywordflow}{if}(!file)
00209     \{
00210         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing TetGen mesh (.node)."});
00211     \}
00212     file.close();
00213     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".face"}).c\_str(), std::ios\_base::in);
00214     \textcolor{keywordflow}{if}(!file)
00215     \{
00216         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing TetGen mesh (.face)."});
00217     \}
00218     file.close();
00219     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".ele"}).c\_str(), std::ios\_base::in);
00220     \textcolor{keywordflow}{if}(!file)
00221     \{
00222         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing TetGen mesh (.ele)."});
00223     \}
00224     file.close();
00225 
00226     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes, nFacets, nCells;
00227     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} zone, maxZone, bcId;
00228     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i, j;
00229     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} x, y, z;
00230     std::vector<UInt> tmp, tmpNodes(3), tmpFacets(4);
00231     std::set<UInt> zones;
00232     std::string buffer = \textcolor{stringliteral}{""};
00233 
00234     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00235     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00236     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00237 
00238     \hyperlink{classFVCode3D_1_1Properties}{Properties} prop;
00239 
00240     \textcolor{comment}{// Read nodes}
00241     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".node"}).c\_str(), std::ios\_base::in);
00242 
00243     file >> nNodes;
00244     nodesRef.reserve(nNodes);
00245     file >> buffer; \textcolor{comment}{// garbage}
00246     file >> buffer; \textcolor{comment}{// garbage}
00247     file >> buffer; \textcolor{comment}{// garbage}
00248 
00249     \textcolor{keywordflow}{for}(i=0; i < nNodes; ++i)
00250     \{
00251         file >> buffer; \textcolor{comment}{// id, garbage}
00252         file >> x; file >> y; file >> z;
00253         nodesRef.emplace\_back(x,y,z); \textcolor{comment}{// Point3D}
00254     \}
00255 
00256     file.close();
00257 
00258     \textcolor{comment}{// Read facets}
00259     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".face"}).c\_str(), std::ios\_base::in);
00260 
00261     file >> nFacets;
00262     file >> buffer; \textcolor{comment}{// garbage}
00263 
00264     std::shared\_ptr<PermeabilityScalar> permPtr(\textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00265     permPtr->setPermeability(1. , 0);
00266 
00267     tmp.resize(3);
00268     \textcolor{keywordflow}{for}(i=0; i < nFacets; ++i)
00269     \{
00270         file >> buffer; \textcolor{comment}{// id, garbage}
00271         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < 3; ++j)
00272         \{
00273             file >> tmp[j];
00274             tmp[j]--;
00275         \}
00276         file >> zone;
00277         bcId = (zone <= 1000 && zone > 0) ? 1 : 0;
00278         zone = (zone > 1000) && (zone <= 2000) ? zone : 0;
00279         facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, (zone)*static\_cast<UInt>(fracturesOn), bcId) );
00280         \textcolor{keywordflow}{if}(zone > 1 && fracturesOn && zones.find(zone) == zones.end())
00281         \{
00282             prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00283             \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(zone, prop);
00284             zones.insert(zone);
00285         \}
00286     \}
00287     tmp.clear();
00288 
00289     file.close();
00290 
00291     \textcolor{comment}{// Read cells}
00292     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{".ele"}).c\_str(), std::ios\_base::in);
00293 
00294     file >> nCells;
00295     file >> buffer; \textcolor{comment}{// garbage}
00296     file >> buffer; \textcolor{comment}{// garbage}
00297 
00298     maxZone = (zones.size() > 0) ? *std::max\_element(zones.begin(), zones.end()) : 0;
00299     prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00300     \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(maxZone+1, prop);
00301 
00302     \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a609f980329f5a98e9fad724049e509d2}{buildNodesToFacetMap}();
00303 
00304     tmp.resize(4);
00305     \textcolor{keywordflow}{for}(i=0; i < nCells; ++i)
00306     \{
00307         file >> buffer; \textcolor{comment}{// id, garbage}
00308         \textcolor{comment}{// get the nodes that define the cell}
00309         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < 4; ++j)
00310         \{
00311             file >> tmp[j];
00312             tmp[j]--;
00313         \}
00314 
00315         \textcolor{comment}{// costruisco le facce della cella partendo dai nodi}
00316         \textcolor{keywordflow}{for}(j=0; j < 4; ++j)
00317         \{
00318             tmpNodes[0] = tmp[j % 4];
00319             tmpNodes[1] = tmp[(j+1) % 4];
00320             tmpNodes[2] = tmp[(j+2) % 4];
00321             tmpFacets[j] = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmpNodes);
00322         \}
00323 
00324         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmpFacets, maxZone+1) );
00325     \}
00326     tmp.clear();
00327 
00328     file.close();
00329 \}
00330 
\hypertarget{Import_8cpp_source.tex_l00331}{}\hyperlink{classFVCode3D_1_1ImporterTPFA_adafe208596baeaca51051ea9692fa757}{00331} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1ImporterTPFA_adafe208596baeaca51051ea9692fa757}{ImporterTPFA::import}(\textcolor{keywordtype}{bool} fracturesOn) \textcolor{keywordflow}{throw}()
00332 \{
00333     std::ifstream file;
00334     file.open(\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename}.c\_str(), std::ios\_base::in);
00335     \textcolor{keywordflow}{if}(!file)
00336     \{
00337         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing TPFA mesh."});
00338     \}
00339 
00340     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes, nFacets, nCells, nZones, volumeCorrection;
00341     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nodesFacet, facetsCell, bcId=0;
00342     \hyperlink{namespaceFVCode3D_a2263c42382b217732a2d4e1f7348120a}{Int} zone;
00343     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i, j;
00344     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} x, y, z;
00345     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} aperture, porosity, permeability;
00346     std::vector<UInt> tmp;
00347 
00348     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00349     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00350     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00351 
00352     \hyperlink{classFVCode3D_1_1Properties}{Properties} prop;
00353 
00354     \textcolor{comment}{// Read header}
00355     file >> nNodes;
00356     file >> nFacets;
00357     file >> nCells;
00358     file >> nZones;
00359     file >> volumeCorrection;
00360 
00361     \textcolor{comment}{// Read nodes}
00362     nodesRef.reserve(nNodes);
00363 
00364     \textcolor{keywordflow}{for}(i=0; i < nNodes; ++i)
00365     \{
00366         file >> x; file >> y; file >> z;
00367         nodesRef.emplace\_back(x,y,z); \textcolor{comment}{// Point3D}
00368     \}
00369 
00370     \textcolor{comment}{// Read facets}
00371     \textcolor{keywordflow}{for}(i=0; i < nFacets; ++i)
00372     \{
00373         file >> nodesFacet;
00374         tmp.resize(nodesFacet);
00375 
00376         \textcolor{keywordflow}{for}(j=0; j < nodesFacet; ++j)
00377             file >> tmp[j];
00378         file >> zone;
00379         facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, (zone+1)*static\_cast<UInt>(fracturesOn), bcId) );
00380     \}
00381 
00382     \textcolor{comment}{// Read cells}
00383     \textcolor{keywordflow}{for}(i=0; i < nCells; ++i)
00384     \{
00385         file >> facetsCell;
00386         tmp.resize(facetsCell);
00387 
00388         \textcolor{keywordflow}{for}(j=0; j < facetsCell; ++j)
00389             file >> tmp[j];
00390         file >> zone;
00391         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, zone+1) );
00392     \}
00393     tmp.clear();
00394 
00395     std::shared\_ptr<PermeabilityScalar> permPtr(\textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00396 
00397     \textcolor{comment}{// Read properties}
00398     \textcolor{keywordflow}{for}(i=0; i < nZones; ++i)
00399     \{
00400         file >> zone;
00401         file >> aperture;
00402         file >> porosity;
00403         file >> permeability; \textcolor{comment}{// dummy parameter}
00404         file >> permeability;
00405 
00406         permPtr->setPermeability(permeability, 0);
00407 
00408         prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(aperture, porosity, permPtr);
00409         \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(zone+1, prop);
00410     \}
00411 
00412     file.close();
00413 \}
00414 
\hypertarget{Import_8cpp_source.tex_l00415}{}\hyperlink{classFVCode3D_1_1ImporterOpenFOAM_ac8d43d9c6d007f5637e5878cef77df5e}{00415} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1ImporterOpenFOAM_ac8d43d9c6d007f5637e5878cef77df5e}{ImporterOpenFOAM::import}(\textcolor{keywordtype}{bool} fracturesOn) \textcolor{keywordflow}{throw}()
00416 \{
00417     std::ifstream file;
00418 
00419     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"points"}).c\_str(), std::ios\_base::in);
00420     \textcolor{keywordflow}{if}(!file)
00421     \{
00422         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing points."});
00423     \}
00424     file.close();
00425     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"faces"}).c\_str(), std::ios\_base::in);
00426     \textcolor{keywordflow}{if}(!file)
00427     \{
00428         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing faces."});
00429     \}
00430     file.close();
00431     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"owner"}).c\_str(), std::ios\_base::in);
00432     \textcolor{keywordflow}{if}(!file)
00433     \{
00434         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing owner."});
00435     \}
00436     file.close();
00437     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"neighbour"}).c\_str(), std::ios\_base::in);
00438     \textcolor{keywordflow}{if}(!file)
00439     \{
00440         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing neighbour."});
00441     \}
00442     file.close();
00443     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"boundary"}).c\_str(), std::ios\_base::in);
00444     \textcolor{keywordflow}{if}(!file)
00445     \{
00446         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing boundary."});
00447     \}
00448     file.close();
00449 
00450     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes, nFacets, nOwner, nNeigh, nPatch;
00451     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nodesFacet;
00452     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i, j;
00453     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} x,y,z;
00454     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} cellId, patchId, maxPatchId = 0;
00455     std::vector<UInt> tmp;
00456 
00457     \textcolor{keyword}{enum class} faceType : \hyperlink{namespaceFVCode3D_a0319e74922d1d700fbc06e470e0cfc07}{SUInt}
00458     \{
00459         None, \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a7d38403d00598d4bb163911f9aa48294}{Internal}, Boundary, Fracture
00460     \};
00461 
00462     std::map<Point3D, UInt> vertexMap;
00463     std::map<Mesh3D::Facet3D, UInt> facetMap;
00464     std::pair< std::map<Point3D,UInt>::iterator, \textcolor{keywordtype}{bool} > itMap;
00465     std::pair< std::map<Mesh3D::Facet3D,UInt>::iterator, \textcolor{keywordtype}{bool} > itMapF;
00466     std::vector<UInt> fullToLocal;
00467     std::vector<UInt> fullToLocalFaces;
00468     std::vector<faceType> typeFaces;
00469     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} vertexId = 0;
00470     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} facetId = 0;
00471 
00472     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00473     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00474     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00475     \hyperlink{classFVCode3D_1_1Properties}{Properties} prop;
00476     std::shared\_ptr<PermeabilityScalar> permPtr(\textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00477     permPtr->setPermeability(1. , 0);
00478 
00479     std::string buffer = \textcolor{stringliteral}{""};
00480     std::vector< std::string > tokens;
00481     std::vector< std::string > subTokens;
00482     \textcolor{keyword}{const} std::string initString =
00483         \textcolor{stringliteral}{"// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //"};
00484 
00485     \textcolor{comment}{// Read nodes}
00486     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"points"}).c\_str(), std::ios\_base::in);
00487 
00488     \textcolor{keywordflow}{while}(buffer != initString)
00489     \{
00490         std::getline(file, buffer);
00491     \}
00492 
00493     file.imbue(std::locale(file.getloc(), \textcolor{keyword}{new} \hyperlink{structFVCode3D_1_1MyDelimiters}{MyDelimiters}));
00494 
00495     buffer.clear();
00496     \textcolor{keywordflow}{while}(buffer == \textcolor{stringliteral}{""})
00497     \{
00498         file >> buffer;
00499     \}
00500 
00501     nNodes = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer);
00502     nodesRef.reserve(nNodes);
00503     fullToLocal.resize(nNodes);
00504 
00505     \textcolor{keywordflow}{for}(i=0; i < nNodes; ++i)
00506     \{
00507         file >> x; file >> y; file >> z;
00508 
00509         \hyperlink{classFVCode3D_1_1Point3D}{Point3D} V(x, y, z);
00510         itMap = vertexMap.insert(std::pair<FVCode3D::Point3D,UInt>(V, 0));
00511 
00512         \textcolor{keywordflow}{if} (itMap.second)
00513         \{
00514             itMap.first->second = vertexId;
00515             nodesRef.emplace\_back(x, y, z); \textcolor{comment}{// Point3D}
00516             ++vertexId;
00517         \}
00518         fullToLocal[i] = itMap.first->second;
00519     \}
00520     nNodes = vertexId;
00521 
00522     file.imbue(std::locale::classic());
00523     file.close();
00524 
00525     \textcolor{comment}{// Read faces}
00526     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"faces"}).c\_str(), std::ios\_base::in);
00527 
00528     \textcolor{keywordflow}{while}(buffer != initString)
00529     \{
00530         std::getline(file, buffer);
00531     \}
00532 
00533     file.imbue(std::locale(file.getloc(), \textcolor{keyword}{new} \hyperlink{structFVCode3D_1_1MyDelimiters}{MyDelimiters}));
00534 
00535     buffer.clear();
00536     \textcolor{keywordflow}{while}(buffer == \textcolor{stringliteral}{""})
00537     \{
00538         file >> buffer;
00539     \}
00540 
00541     nFacets = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer);
00542     fullToLocalFaces.resize(nFacets);
00543 
00544     \textcolor{keywordflow}{for}(i=0; i < nFacets; ++i)
00545     \{
00546         file >> nodesFacet;
00547         tmp.resize(nodesFacet);
00548 
00549         \textcolor{keywordflow}{for}(j=0; j < nodesFacet; ++j)
00550         \{
00551             file >> tmp[j];
00552             tmp[j] = fullToLocal[tmp[j]];
00553         \}
00554 
00555         \hyperlink{classFVCode3D_1_1Mesh3D_1_1Facet3D}{Mesh3D::Facet3D} facet(&\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, 0, 0);
00556         itMapF = facetMap.insert(std::pair<Mesh3D::Facet3D, UInt>(facet,0));
00557 
00558         \textcolor{keywordflow}{if}(itMapF.second)
00559         \{
00560             itMapF.first->second = facetId;
00561             facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(facetId), 
      std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, 0, 0) );
00562             ++facetId;
00563         \}
00564         fullToLocalFaces[i] = itMapF.first->second;
00565     \}
00566     nFacets = facetId;
00567 
00568     file.imbue(std::locale::classic());
00569     file.close();
00570 
00571     \textcolor{comment}{// Read owner}
00572     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"owner"}).c\_str(), std::ios\_base::in);
00573 
00574     \textcolor{keywordflow}{while}(buffer != initString)
00575     \{
00576         std::getline(file, buffer);
00577     \}
00578 
00579     file.imbue(std::locale(file.getloc(), \textcolor{keyword}{new} \hyperlink{structFVCode3D_1_1MyDelimiters}{MyDelimiters}));
00580 
00581     buffer = \textcolor{stringliteral}{""};
00582     \textcolor{keywordflow}{while}(buffer == \textcolor{stringliteral}{""})
00583     \{
00584         file >> buffer;
00585     \}
00586 
00587     nOwner = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer);
00588     typeFaces.resize(nFacets, faceType::None);
00589 
00590     \textcolor{keywordflow}{for}(i=0; i < nOwner; ++i)
00591     \{
00592         file >> cellId;
00593         \textcolor{keywordflow}{if}( facetsRef[fullToLocalFaces[i]].getSeparatedCells().size() > 0 )
00594         \{
00595             typeFaces[fullToLocalFaces[i]] = faceType::Fracture;
00596         \}
00597         facetsRef[fullToLocalFaces[i]].getSeparatedCells().insert(cellId);
00598 
00599         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(cellId), std::forward\_as\_tuple() 
      );
00600         cellsRef[cellId].setMesh(&\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh});
00601         cellsRef[cellId].getFacetsSet().insert(fullToLocalFaces[i]);
00602     \}
00603     file.imbue(std::locale::classic());
00604     file.close();
00605 
00606 \textcolor{comment}{// Probably this is useless. I don't know how the double faces are managed in openFoam.}
00607 \textcolor{comment}{// Enable this piece of code if you can't load the fractures, and try...}
00608 \textcolor{comment}{//    for(auto facet : facetsRef)}
00609 \textcolor{comment}{//    \{}
00610 \textcolor{comment}{//        if( facet.second.getSeparatedCells().size() == 2 )}
00611 \textcolor{comment}{//        \{}
00612 \textcolor{comment}{//            typeFaces[facet.first] = faceType::Fracture;}
00613 \textcolor{comment}{//        \}}
00614 \textcolor{comment}{//    \}}
00615 
00616     \textcolor{comment}{// Read neighbour}
00617     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"neighbour"}).c\_str(), std::ios\_base::in);
00618 
00619     \textcolor{keywordflow}{while}(buffer != initString)
00620     \{
00621         std::getline(file, buffer);
00622     \}
00623 
00624     file.imbue(std::locale(file.getloc(), \textcolor{keyword}{new} \hyperlink{structFVCode3D_1_1MyDelimiters}{MyDelimiters}));
00625 
00626     buffer = \textcolor{stringliteral}{""};
00627     \textcolor{keywordflow}{while}(buffer == \textcolor{stringliteral}{""})
00628     \{
00629         file >> buffer;
00630     \}
00631 
00632     nNeigh = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer);
00633 
00634     \textcolor{keywordflow}{for}(i=0; i < nNeigh; ++i)
00635     \{
00636         file >> cellId;
00637         facetsRef[fullToLocalFaces[i]].getSeparatedCells().insert(cellId);
00638 
00639         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(cellId), std::forward\_as\_tuple() 
      );
00640         cellsRef[cellId].setMesh(&\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh});
00641         cellsRef[cellId].getFacetsSet().insert(fullToLocalFaces[i]);
00642     \}
00643     file.imbue(std::locale::classic());
00644     file.close();
00645 
00646     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} facet : facetsRef)
00647     \{
00648         \textcolor{keywordflow}{if}( typeFaces[facet.first] == faceType::None)
00649         \{
00650             \textcolor{keywordflow}{if}( facet.second.getSeparatedCells().size() == 1 )
00651             \{
00652                 typeFaces[facet.first] = faceType::Boundary;
00653             \}
00654             \textcolor{keywordflow}{else}
00655             \{
00656                 typeFaces[facet.first] = \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a7d38403d00598d4bb163911f9aa48294}{faceType::Internal};
00657             \}
00658         \}
00659     \}
00660 
00661     \textcolor{comment}{// Read boundary}
00662     file.open( (\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename} + \textcolor{stringliteral}{"boundary"}).c\_str(), std::ios\_base::in);
00663 
00664     \textcolor{keywordflow}{while}(buffer != initString)
00665     \{
00666         std::getline(file, buffer);
00667     \}
00668 
00669     file.imbue(std::locale(file.getloc(), \textcolor{keyword}{new} \hyperlink{structFVCode3D_1_1MyDelimiters}{MyDelimiters}));
00670 
00671     buffer = \textcolor{stringliteral}{""};
00672     \textcolor{keywordflow}{while}(buffer == \textcolor{stringliteral}{""})
00673     \{
00674         file >> buffer;
00675     \}
00676 
00677     nPatch = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer);
00678 
00679     \textcolor{keywordflow}{for}(i=0; i < nPatch; ++i)
00680     \{
00681         std::size\_t found;
00682         \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} startId, patchLength;
00683 
00684         \textcolor{keywordflow}{do}
00685         \{
00686             std::getline(file, buffer);
00687             found = buffer.find(\textcolor{stringliteral}{"patch"});
00688         \}
00689         \textcolor{keywordflow}{while}(found==std::string::npos);
00690 
00691         patchId = \hyperlink{namespaceFVCode3D_a7d8605df83383ec5cf62f7efe480a68a}{lexical\_cast}<\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}>(buffer.substr(found+5));
00692         maxPatchId = (patchId > maxPatchId) ? patchId : maxPatchId;
00693 
00694         \textcolor{keywordflow}{for}(j=0; j<6; ++j)
00695         \{
00696             file >> buffer; \textcolor{comment}{// garbage}
00697         \}
00698 
00699         file >> patchLength;
00700         file >> buffer; \textcolor{comment}{// garbage}
00701         file >> startId;
00702 
00703         \textcolor{keywordflow}{for}(j=startId; j < (startId+patchLength); ++j)
00704         \{
00705             \textcolor{keywordflow}{if}(typeFaces[fullToLocalFaces[j]]==faceType::Boundary)
00706             \{
00707                 facetsRef[fullToLocalFaces[j]].setBorderID(patchId);
00708             \}
00709             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (fracturesOn)
00710             \{
00711                 facetsRef[fullToLocalFaces[j]].setZoneCode( patchId );
00712                 prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00713                 \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(patchId, prop);
00714             \}
00715         \}
00716     \}
00717 
00718     file.imbue(std::locale::classic());
00719     file.close();
00720 
00721     \textcolor{comment}{// build cells}
00722     ++maxPatchId;
00723     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} & cell : cellsRef)
00724     \{
00725         cell.second.setZoneCode(maxPatchId);
00726         cell.second.computeVertexIds();
00727         cell.second.computeVolumeAndCentroid();
00728     \}
00729     prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(1., 1., permPtr);
00730     \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(maxPatchId, prop);
00731 
00732     \textcolor{comment}{// clear the separated cells from the facets}
00733     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} & facet : facetsRef)
00734     \{
00735         facet.second.getSeparatedCells().clear();
00736     \}
00737 \}
00738 
\hypertarget{Import_8cpp_source.tex_l00739}{}\hyperlink{classFVCode3D_1_1ImporterForSolver_a4ad5aee92b6abe9b6ed5150c707a83ad}{00739} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1ImporterForSolver_a4ad5aee92b6abe9b6ed5150c707a83ad}{ImporterForSolver::import}(\textcolor{keywordtype}{bool} fracturesOn) \textcolor{keywordflow}{throw}()
00740 \{
00741     std::ifstream file;
00742     file.open(\hyperlink{classFVCode3D_1_1Importer_a318e689fb93c5c906f85aa13685724d7}{M\_filename}.c\_str(), std::ios\_base::in);
00743     \textcolor{keywordflow}{if}(!file)
00744     \{
00745         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"Error: file not opened when importing .fvg mesh."});
00746     \}
00747 
00748     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes, nFacets, nCells, nFractures;
00749     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nodesFacet, facetsCell, facetsFracture, nSepCells, bcId, isFrac;
00750     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} zone, facetId;
00751     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i, j;
00752     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} x, y, z;
00753     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} aperture, porosity, permeability;
00754     std::vector<UInt> tmp;
00755     std::string buffer = \textcolor{stringliteral}{""};
00756     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} permSize = 6;
00757 
00758     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00759     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00760     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00761     \hyperlink{classFVCode3D_1_1FractureNetwork3D}{FractureNetwork3D} & FN = \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a6ba176804035a210ee1f73348ec04aca}{getFN}();
00762     \hyperlink{classFVCode3D_1_1Properties}{Properties} prop;
00763 
00764     \textcolor{comment}{// Read nodes}
00765     \textcolor{keyword}{const} std::string s2findN = \textcolor{stringliteral}{"POINTS"};
00766     \textcolor{keywordflow}{while}(buffer!=s2findN)
00767         file >> buffer;
00768 
00769     file >> nNodes;
00770     nodesRef.reserve(nNodes);
00771 
00772     \textcolor{keywordflow}{for}(i=0; i < nNodes; ++i)
00773     \{
00774         file >> x; file >> y; file >> z;
00775         nodesRef.emplace\_back(x,y,z); \textcolor{comment}{// Point3D}
00776     \}
00777 
00778     \textcolor{comment}{// Read facets with properties}
00779     \textcolor{keyword}{const} std::string s2findF = \textcolor{stringliteral}{"FACETS"};
00780     \textcolor{keywordflow}{while}(buffer!=s2findF)
00781         file >> buffer;
00782 
00783     file >> nFacets;
00784 
00785     \hyperlink{namespaceFVCode3D_aee5ae48a57366603109f90f526a645b1}{PermPtr\_Type} permPtr;
00786 
00787     zone = 1;
00788     \textcolor{keywordflow}{for}(i=0; i < nFacets; ++i)
00789     \{
00790         file >> nodesFacet;
00791         tmp.resize(nodesFacet);
00792 
00793         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < nodesFacet; ++j)
00794             file >> tmp[j];
00795         file >> nSepCells;
00796         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j<nSepCells; ++j)
00797             file >> buffer;
00798         file >> bcId;
00799         file >> isFrac;
00800         \textcolor{keywordflow}{if} (bcId && isFrac)
00801         \{
00802             isFrac = 0;
00803             \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j<permSize + 2; ++j)
00804                 file >> buffer;
00805         \}
00806 
00807         \textcolor{keywordflow}{if}(isFrac)
00808         \{
00809             file >> aperture;
00810             file >> porosity;
00811             \textcolor{keywordflow}{switch}(permSize)
00812             \{
00813                 \textcolor{keywordflow}{case} 1:
00814                     permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00815                     \textcolor{keywordflow}{break};
00816                 \textcolor{keywordflow}{case} 3:
00817                     permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityDiagonal}{PermeabilityDiagonal});
00818                     \textcolor{keywordflow}{break};
00819                 \textcolor{keywordflow}{case} 6:
00820                     permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilitySymTensor}{PermeabilitySymTensor});
00821                     \textcolor{keywordflow}{break};
00822                 \textcolor{keywordflow}{case} 9:
00823                     permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityFullTensor}{PermeabilityFullTensor});
00824                     \textcolor{keywordflow}{break};
00825             \}
00826 
00827             \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j<permSize; ++j)
00828             \{
00829                 file >> permeability;
00830                 permPtr->operator[](j) = permeability;
00831             \}
00832         \}
00833         facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i),
00834                            std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp,
00835                            isFrac*static\_cast<UInt>(fracturesOn)*zone, bcId) );
00836         \textcolor{keywordflow}{if} (isFrac*static\_cast<UInt>(fracturesOn))
00837         \{
00838             prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(aperture, porosity, permPtr);
00839             \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(zone, prop);
00840             zone++;
00841         \}
00842     \}
00843 
00844     \textcolor{comment}{// Read cells with properties}
00845     \textcolor{keyword}{const} std::string s2findC = \textcolor{stringliteral}{"CELLS"};
00846     \textcolor{keywordflow}{while}(buffer!=s2findC)
00847         file >> buffer;
00848 
00849     file >> nCells;
00850 
00851     aperture = 1.;
00852     \textcolor{keywordflow}{for}(i=0; i < nCells; ++i)
00853     \{
00854         file >> facetsCell;
00855         tmp.resize(facetsCell);
00856 
00857         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j < facetsCell; ++j)
00858             file >> tmp[j];
00859 
00860         file >> porosity;
00861         \textcolor{keywordflow}{switch}(permSize)
00862         \{
00863             \textcolor{keywordflow}{case} 1:
00864                 permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar});
00865                 \textcolor{keywordflow}{break};
00866             \textcolor{keywordflow}{case} 3:
00867                 permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityDiagonal}{PermeabilityDiagonal});
00868                 \textcolor{keywordflow}{break};
00869             \textcolor{keywordflow}{case} 6:
00870                 permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilitySymTensor}{PermeabilitySymTensor});
00871                 \textcolor{keywordflow}{break};
00872             \textcolor{keywordflow}{case} 9:
00873                 permPtr.reset( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityFullTensor}{PermeabilityFullTensor});
00874                 \textcolor{keywordflow}{break};
00875         \}
00876 
00877         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j<permSize; ++j)
00878         \{
00879             file >> permeability;
00880             permPtr->operator[](j) = permeability;
00881         \}
00882 
00883         cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(i), std::forward\_as\_tuple(&
      \hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, zone) );
00884         prop.\hyperlink{classFVCode3D_1_1Properties_a0ddb477254cfacdb96a440ddedc2548c}{setProperties}(aperture, porosity, permPtr);
00885         \hyperlink{classFVCode3D_1_1Importer_af678e18e971d5a132f5ba494981f6dae}{M\_properties}.\hyperlink{classFVCode3D_1_1PropertiesMap_ac303adadd1101e7bee62ecad0e8ea6ac}{setZone}(zone, prop);
00886         zone++;
00887     \}
00888     tmp.clear();
00889 
00890     \textcolor{comment}{// Read fracture network}
00891     \textcolor{keyword}{const} std::string s2findFN= \textcolor{stringliteral}{"FRACTURE\_NETWORK"};
00892     \textcolor{keywordflow}{while}(buffer!=s2findFN)
00893         file >> buffer;
00894 
00895     file >> nFractures;
00896 
00897     FN.\hyperlink{classFVCode3D_1_1FractureNetwork3D_ad9a40fd0d922b50d29d60e8c4d65f496}{getNetwork}().reserve(nFractures);
00898 
00899     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} fracOn = nFractures*\textcolor{keyword}{static\_cast<}\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt}\textcolor{keyword}{>}(fracturesOn);
00900     \textcolor{keywordflow}{for}(i=0; i < fracOn; ++i)
00901     \{
00902         file >> facetsFracture;
00903         tmp.reserve(facetsFracture);
00904         \textcolor{keywordflow}{for}(j=0; j < facetsFracture; ++j)
00905         \{
00906             file >> facetId;
00907             \textcolor{keywordflow}{if}( ! facetsRef[facetId].isBorderFacet() )
00908                 tmp.push\_back(facetId);
00909         \}
00910         \textcolor{keywordflow}{if}(tmp.size()>0)
00911             FN.\hyperlink{classFVCode3D_1_1FractureNetwork3D_ad9a40fd0d922b50d29d60e8c4d65f496}{getNetwork}().emplace\_back(\hyperlink{classFVCode3D_1_1Importer_a6f1542d6c6ac192e36c8eec7dc366653}{M\_mesh}, tmp, i); \textcolor{comment}{// Fracture3D}
00912         tmp.clear();
00913     \}
00914 
00915     file.close();
00916 \}
00917 
00918 \} \textcolor{comment}{// namespace FVCode3D}
\end{DoxyCode}
