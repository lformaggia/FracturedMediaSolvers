\hypertarget{main_8cpp_source}{}\section{main.\+cpp}
\label{main_8cpp_source}\index{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/main.\+cpp@{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/main.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{// Add this macro to disable asserts}
00002 \textcolor{comment}{//#define NDEBUG}
00003 
00004 \textcolor{comment}{// Add this macro the enable the exporter}
00005 \textcolor{comment}{//#define FVCODE3D\_EXPORT}
00006 
00007 \textcolor{preprocessor}{#include <cassert>}
00008 \textcolor{preprocessor}{#include <iostream>}
00009 \textcolor{preprocessor}{#include <chrono>}
00010 \textcolor{preprocessor}{#include <vector>}
00011 \textcolor{preprocessor}{#include <fstream>}
00012 
00013 \textcolor{preprocessor}{#include <unsupported/Eigen/SparseExtra>}
00014 \textcolor{preprocessor}{#include <\hyperlink{TypeDefinition_8hpp}{FVCode3D/core/TypeDefinition.hpp}>}
00015 \textcolor{preprocessor}{#include <\hyperlink{Data_8hpp}{FVCode3D/core/Data.hpp}>}
00016 \textcolor{preprocessor}{#include <\hyperlink{RigidMesh_8hpp}{FVCode3D/mesh/RigidMesh.hpp}>}
00017 \textcolor{preprocessor}{#include <\hyperlink{Properties_8hpp}{FVCode3D/property/Properties.hpp}>}
00018 \textcolor{preprocessor}{#include <\hyperlink{Permeability_8hpp}{FVCode3D/property/Permeability.hpp}>}
00019 \textcolor{preprocessor}{#include <\hyperlink{CartesianGrid_8hpp}{FVCode3D/mesh/CartesianGrid.hpp}>}
00020 \textcolor{preprocessor}{#include <\hyperlink{BC_8hpp}{FVCode3D/boundaryCondition/BC.hpp}>}
00021 \textcolor{preprocessor}{#include <\hyperlink{Quadrature_8hpp}{FVCode3D/quadrature/Quadrature.hpp}>}
00022 \textcolor{preprocessor}{#include <\hyperlink{Import_8hpp}{FVCode3D/import/Import.hpp}>}
00023 \textcolor{preprocessor}{#include <\hyperlink{ExportVTU_8hpp}{FVCode3D/export/ExportVTU.hpp}>}
00024 \textcolor{preprocessor}{#include <\hyperlink{Converter_8hpp}{FVCode3D/utility/Converter.hpp}>}
00025 \textcolor{preprocessor}{#include <\hyperlink{Problem_8hpp}{FVCode3D/problem/Problem.hpp}>}
00026 \textcolor{preprocessor}{#include <\hyperlink{DarcySteady_8hpp}{FVCode3D/problem/DarcySteady.hpp}>}
00027 \textcolor{preprocessor}{#include <\hyperlink{DarcyPseudoSteady_8hpp}{FVCode3D/problem/DarcyPseudoSteady.hpp}>}
00028 \textcolor{preprocessor}{#include <\hyperlink{FixPressureDofs_8hpp}{FVCode3D/assembler/FixPressureDofs.hpp}>}
00029 \textcolor{preprocessor}{#include <\hyperlink{MultipleSubRegions_8hpp}{FVCode3D/multipleSubRegions/MultipleSubRegions.hpp}
      >}
00030 \textcolor{preprocessor}{#include <\hyperlink{Evaluate_8hpp}{FVCode3D/utility/Evaluate.hpp}>}
00031 \textcolor{preprocessor}{#include "\hyperlink{functions_8hpp}{functions.hpp}"}
00032 
00033 \textcolor{keyword}{using namespace }\hyperlink{namespaceFVCode3D}{FVCode3D};
00034 
\hypertarget{main_8cpp_source.tex_l00035}{}\hyperlink{main_8cpp_a3c96af59123b410487ff565fb24281ed}{00035} \textcolor{keyword}{typedef} \hyperlink{classFVCode3D_1_1Problem}{Problem<CentroidQuadrature, CentroidQuadrature>} 
      \hyperlink{main_8cpp_a3c96af59123b410487ff565fb24281ed}{Pb};
\hypertarget{main_8cpp_source.tex_l00036}{}\hyperlink{main_8cpp_ab0de87680f9f2dfa547e659c7da3d1e4}{00036} \textcolor{keyword}{typedef} \hyperlink{classFVCode3D_1_1DarcySteady}{DarcySteady<CentroidQuadrature, CentroidQuadrature>}
       \hyperlink{main_8cpp_ab0de87680f9f2dfa547e659c7da3d1e4}{DarcyPb};
\hypertarget{main_8cpp_source.tex_l00037}{}\hyperlink{main_8cpp_aff54e4c6bbc30b11899898af00325b15}{00037} \textcolor{keyword}{typedef} 
      \hyperlink{classFVCode3D_1_1DarcyPseudoSteady}{DarcyPseudoSteady<CentroidQuadrature, CentroidQuadrature, SpMat, TimeScheme::BDF2>}
       \hyperlink{main_8cpp_aff54e4c6bbc30b11899898af00325b15}{PseudoDarcyPb};
00038 
\hypertarget{main_8cpp_source.tex_l00039}{}\hyperlink{main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{00039} \textcolor{keywordtype}{int} \hyperlink{main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} * argv[])
00040 \{
00041     GetPot command\_line(argc,argv);
00042     \textcolor{keyword}{const} std::string dataFileName = command\_line.follow(\textcolor{stringliteral}{"data.txt"}, 2, \textcolor{stringliteral}{"-f"}, \textcolor{stringliteral}{"--file"});
00043 
00044     \hyperlink{classFVCode3D_1_1Chrono}{Chrono} chrono;
00045     chrono.\hyperlink{classFVCode3D_1_1Chrono_a13f2f4fa4096ec9eafa7ad59fea3df87}{start}();
00046 
00047     std::cout << \textcolor{stringliteral}{"Read Data from "} << dataFileName << \textcolor{stringliteral}{"..."} << std::flush;
00048     \hyperlink{namespaceFVCode3D_a3d19a370a98afe491a9e17a646a9c56f}{DataPtr\_Type} dataPtr(\textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1Data}{Data}(dataFileName));
00049     std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00050 
00051     std::cout << std::endl;
00052     dataPtr->showMe();
00053     std::cout << std::endl;
00054 
00055 
00056     std::cout << \textcolor{stringliteral}{"Define Mesh and Properties..."} << std::flush;
00057     \hyperlink{classFVCode3D_1_1Mesh3D}{Mesh3D} mesh;
00058     \hyperlink{classFVCode3D_1_1PropertiesMap}{PropertiesMap} propMap(dataPtr->getMobility(), dataPtr->getCompressibility());
00059     std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00060 
00061 
00062     std::cout << \textcolor{stringliteral}{"Create Importer..."} << std::flush;
00063     \hyperlink{classFVCode3D_1_1Importer}{Importer} * importer = 0;
00064     \textcolor{keywordflow}{if}(dataPtr->getMeshType() == Data::MeshFormatType::TPFA)
00065         importer = \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1ImporterTPFA}{ImporterTPFA}(dataPtr->getMeshDir() + dataPtr->getMeshFile(), mesh, 
      propMap);
00066     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(dataPtr->getMeshType() == Data::MeshFormatType::forSolver)
00067         importer = \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1ImporterForSolver}{ImporterForSolver}(dataPtr->getMeshDir() + dataPtr->getMeshFile(), 
      mesh, propMap);
00068     std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00069 
00070 
00071     std::cout << \textcolor{stringliteral}{"Import grid file..."} << std::flush;
00072     importer->\hyperlink{classFVCode3D_1_1Importer_aee8e68c30c3fd4a01f10a5a4365b30ea}{import}(dataPtr->fractureOn());
00073     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00074 
00075     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00076 
00077 
00078     std::cout << \textcolor{stringliteral}{"Compute separated cells..."} << std::flush;
00079     mesh.\hyperlink{classFVCode3D_1_1Mesh3D_ab1595d6ad6373719cf597c323ed6909b}{updateFacetsWithCells}();
00080     std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00081 
00082 
00083     std::cout << \textcolor{stringliteral}{"Compute neighboring cells..."} << std::flush;
00084     mesh.\hyperlink{classFVCode3D_1_1Mesh3D_a32920906ccad9ef0572ebc4009214c86}{updateCellsWithNeighbors}();
00085     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00086 
00087     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00088 
00089 
00090     std::cout << \textcolor{stringliteral}{"Set labels on boundary"} << std::flush;
00091     \textcolor{keywordflow}{if}(dataPtr->getMeshType() == Data::MeshFormatType::TPFA)
00092     \{
00093         std::cout << \textcolor{stringliteral}{" & add Fractures..."} << std::flush;
00094         importer->\hyperlink{classFVCode3D_1_1Importer_ac21d82671c21b2e4069511ef0585d7f6}{addBCAndFractures}(dataPtr->getTheta());
00095     \}
00096     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(dataPtr->getMeshType() == Data::MeshFormatType::forSolver)
00097     \{
00098         std::cout << \textcolor{stringliteral}{"..."} << std::flush;
00099         importer->\hyperlink{classFVCode3D_1_1Importer_a1cba26ff3b2c475a51866361883c59fc}{extractBC}(dataPtr->getTheta());
00100     \}
00101     std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00102 
00103     std::cout << \textcolor{stringliteral}{"Compute facet ids of the fractures..."} << std::flush;
00104     mesh.\hyperlink{classFVCode3D_1_1Mesh3D_a164529f402302f3f74235ad91c8bea07}{updateFacetsWithFractures}();
00105     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00106 
00107     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00108 
00109     std::cout << \textcolor{stringliteral}{"Set uniform properties..."} << std::flush;
00110     std::shared\_ptr<PermeabilityBase> matrixPerm( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityDiagonal}{PermeabilityDiagonal} );
00111     std::shared\_ptr<PermeabilityBase> fracturesPerm( \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1PermeabilityScalar}{PermeabilityScalar} );
00112     matrixPerm->setPermeability( 1., 0 );
00113     matrixPerm->setPermeability( 1., 4 );
00114     matrixPerm->setPermeability( 1., 8 );
00115     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} kf = 1.e3 ; 
00116     fracturesPerm->setPermeability( kf, 0 );
00117     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} aperture = 1.e-2;
00118     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} matrixPoro = 0.25;
00119     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} fracturesPoro = 1; 
00120     propMap.setPropertiesOnMatrix(mesh, matrixPoro, matrixPerm);
00121     propMap.setPropertiesOnFractures(mesh, aperture, fracturesPoro, fracturesPerm);
00122     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00123 
00124     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00125 
00126     \hyperlink{classFVCode3D_1_1ExporterVTU}{ExporterVTU} exporter;
00127 
00128 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00129     std::cout << \textcolor{stringliteral}{"Export..."} << std::flush;
00130     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a8e5eff8e388cf6de1bf1c1deca863ac7}{exportMesh}(mesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_mesh.vtu"});
00131     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_abdb2e3f36907610720d698d9bfa9428d}{exportFractures}(mesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"
      \_fractures.vtu"});
00132     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a5af587a4d971f4d41caecbef3477211b}{exportMeshWithFractures}(mesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_mesh\_fracture.vtu"});
00133     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a12240c4de9e7b3a5bf8f513c873c4547}{exportWithProperties}(mesh, propMap, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_prop.vtu"});
00134     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a672c00cd380554714d09d5d9b0b56a24}{exportWireframe}(mesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"
      \_wire.vtu"});
00135     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_ac043bd93a6a079f864bc1b76a21df6a2}{exportTetrahedralMesh}(mesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_tet.vtu"});
00136     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00137 
00138     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00139 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00140 
00141     std::cout << \textcolor{stringliteral}{"Add BCs..."} << std::flush;
00142 
00143     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} leftBC (
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a7fd633652b3723bb7716b9db0314a61e}{BorderLabel::Left}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a192024697bdaa4fbbb39b8961b747bce}{Dirichlet}, \hyperlink{namespaceFVCode3D_a1a9ede09c77441d292a079fbab60fb82}{fOne} );
00144     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} rightBC(
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a27ec5db52b31c4eba9e240374723f76e}{BorderLabel::Right}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a192024697bdaa4fbbb39b8961b747bce}{Dirichlet}, \hyperlink{namespaceFVCode3D_a2e72cc81c6f214d6e057af7a02599501}{fZero} );
00145     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} backBC (
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a10461eade3dd091368236f82c6f7f498}{BorderLabel::Back}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a30212425b27314b01b40f4984dbf850a}{Neumann}, \hyperlink{namespaceFVCode3D_a2e72cc81c6f214d6e057af7a02599501}{fZero} );
00146     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} frontBC(
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a2b5e7fb79a56dd77e3c62bccd52238e4}{BorderLabel::Front}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a30212425b27314b01b40f4984dbf850a}{Neumann}, \hyperlink{namespaceFVCode3D_a2e72cc81c6f214d6e057af7a02599501}{fZero} );
00147     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} upBC   (
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822a52ff9b0d3195e16d3d8aed882b7e19dd}{BorderLabel::Top}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a30212425b27314b01b40f4984dbf850a}{Neumann}, \hyperlink{namespaceFVCode3D_a2e72cc81c6f214d6e057af7a02599501}{fZero} );
00148     \hyperlink{classFVCode3D_1_1BoundaryConditions_1_1BorderBC}{BoundaryConditions::BorderBC} downBC (
      \hyperlink{namespaceFVCode3D_a604c2047b7f400e68b30a8132178c822aba9e7af6197fd20512d8f2562e913711}{BorderLabel::Bottom}, \hyperlink{namespaceFVCode3D_a73660061f11f1671164ce171a053f8c5a30212425b27314b01b40f4984dbf850a}{Neumann}, \hyperlink{namespaceFVCode3D_a2e72cc81c6f214d6e057af7a02599501}{fZero} );
00149 
00150     std::vector<BoundaryConditions::BorderBC> borders;
00151 
00152     borders.push\_back( backBC );
00153     borders.push\_back( frontBC );
00154     borders.push\_back( leftBC );
00155     borders.push\_back( rightBC );
00156     borders.push\_back( upBC );
00157     borders.push\_back( downBC );
00158 
00159     \hyperlink{classFVCode3D_1_1BoundaryConditions}{BoundaryConditions} BC(borders);
00160     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00161 
00162     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00163 
00164 
00165     std::cout << \textcolor{stringliteral}{"Assemble rigid mesh..."} << std::flush;
00166     \hyperlink{classFVCode3D_1_1Rigid__Mesh}{Rigid\_Mesh} myrmesh(mesh, propMap);
00167     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00168 
00169     myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_a41b79ff22b6d03329967d1ffbe463679}{showMe}();
00170     std::cout << \textcolor{stringliteral}{"hMin: "} << myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_aa814be4bc0f5471c92524a8fce5028f3}{getMinEdgeSize}() << std::endl;
00171     std::cout << \textcolor{stringliteral}{"hMax: "} << myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_a03fd4643756039db62f827e2ad94cdaf}{getMaxEdgeSize}() << std::endl;
00172     std::cout << \textcolor{stringliteral}{"hAve: "} << myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_a55d65366017440b6a5e54e292d5ba1fe}{getAveEdgeSize}() << std::endl;
00173 
00174     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00175 
00176 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00177     std::cout << \textcolor{stringliteral}{"Export Fracture Junctures & Tips..."} << std::flush;
00178     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_aef7601095b83f975d009f9cb68563ae4}{exportFractureJunctures}(myrmesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_junc.vtu"});
00179     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a95853064ccbdab9ab24b3aa6f67ff19c}{exportFractureTips}(myrmesh, dataPtr->getOutputDir() + dataPtr->getOutputFile
      () + \textcolor{stringliteral}{"\_tips.vtu"});
00180     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a3ee8f96689d31f85372b580caffdcc7e}{exportEdges}(myrmesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"
      \_edges.vtu"});
00181     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a15e1d2e6940ac0a37bf3c4d0ee5dc4d5}{exportFacets}(myrmesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"
      \_facets.vtu"});
00182     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00183 
00184     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00185 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00186 
00187     std::cout << \textcolor{stringliteral}{"Build problem..."} << std::flush;
00188     \hyperlink{classFVCode3D_1_1Problem}{Pb} * darcy(\textcolor{keyword}{nullptr});
00189     \textcolor{keywordflow}{if}(dataPtr->getProblemType() == Data::ProblemType::steady)
00190     \{
00191         darcy = \textcolor{keyword}{new} \hyperlink{main_8cpp_ab0de87680f9f2dfa547e659c7da3d1e4}{DarcyPb}(dataPtr->getSolverType(), myrmesh, BC, \hyperlink{namespaceFVCode3D_ae8b0f97f0774db9f0881cfc5f31d93f4}{SS}, dataPtr);
00192     \}
00193     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(dataPtr->getProblemType() == Data::ProblemType::pseudoSteady)
00194     \{
00195         darcy = \textcolor{keyword}{new} \hyperlink{main_8cpp_aff54e4c6bbc30b11899898af00325b15}{PseudoDarcyPb}(dataPtr->getSolverType(), myrmesh, BC, 
      \hyperlink{namespaceFVCode3D_ae8b0f97f0774db9f0881cfc5f31d93f4}{SS}, dataPtr);
00196     \}
00197     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00198 
00199     \textcolor{keywordflow}{if}(dynamic\_cast<IterativeSolver*>(darcy->\hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}()))
00200     \{
00201         \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->\hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->setMaxIter(
      dataPtr->getIterativeSolverMaxIter());
00202         \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->\hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->setTolerance(
      dataPtr->getIterativeSolverTolerance());
00203     \}
00204 
00205     \hyperlink{classFVCode3D_1_1MSR}{MSR<Pb>} * multipleSubRegions(\textcolor{keyword}{nullptr});
00206 
00207     std::cout << \textcolor{stringliteral}{"Solve problem..."} << std::flush;
00208     \textcolor{keywordflow}{if}(dataPtr->getProblemType() == Data::ProblemType::steady)
00209     \{
00210         darcy->\hyperlink{classFVCode3D_1_1Problem_aa3f0a44084a56374f5ac7f242e0e45f7}{assemble}();
00211         \textcolor{keywordflow}{if}(dataPtr->MSROn())
00212         \{
00213             multipleSubRegions = \textcolor{keyword}{new} \hyperlink{classFVCode3D_1_1MSR}{MSR<Pb>}(darcy, dataPtr);
00214             multipleSubRegions->\hyperlink{classFVCode3D_1_1MSR_aea841370ef1133a635c885714670abec}{setup}();
00215         \}
00216         \textcolor{keywordflow}{if}(dataPtr->pressuresInFractures())
00217         \{
00218             \hyperlink{classFVCode3D_1_1FixPressureDofs}{FixPressureDofs<DarcyPb>} fpd(dynamic\_cast<DarcyPb *>(darcy));
00219             fpd.\hyperlink{classFVCode3D_1_1FixPressureDofs_a3393776b99ad339672ba99cfc5c200e2}{apply}(dataPtr->getPressuresInFractures());
00220         \}
00221         darcy->\hyperlink{classFVCode3D_1_1Problem_a7ee30db5a251dc7a9778c821e49cf376}{solve}();
00222         \textcolor{keywordflow}{if}(dynamic\_cast<IterativeSolver*>(darcy->\hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}()))
00223         \{
00224             std::cout << std::endl;
00225             std::cout << \textcolor{stringliteral}{"\(\backslash\)t# iterations: "} << \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->
      \hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->getIter() << std::endl;
00226             std::cout << \textcolor{stringliteral}{"\(\backslash\)tResidual: "} << \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->
      \hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->getResidual() << std::endl;
00227         \}
00228     \}
00229     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(dataPtr->getProblemType() == Data::ProblemType::pseudoSteady)
00230     \{
00231         \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1DarcyPseudoSteady}{PseudoDarcyPb} *\textcolor{keyword}{>}(darcy)->initialize();
00232         \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} iter=0;
00233 
00234         std::cout << std::endl << \textcolor{stringliteral}{" ... initial solution, t = "} << dataPtr->getInitialTime() << \textcolor{stringliteral}{" ..."} << 
      std::endl;
00235 
00236 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00237         std::stringstream ss;
00238         ss << dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_"};
00239         ss << iter;
00240         ss << \textcolor{stringliteral}{".vtu"};
00241         exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a476a1dd02bcba8c31f0d99c7106d0c21}{exportSolution}(myrmesh, ss.str(), \textcolor{keyword}{dynamic\_cast<}
      \hyperlink{classFVCode3D_1_1DarcyPseudoSteady}{PseudoDarcyPb} *\textcolor{keyword}{>}(darcy)->getOldSolution());
00242         ss.str(std::string());
00243         ss << dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_f\_"};
00244         ss << iter;
00245         ss << \textcolor{stringliteral}{".vtu"};
00246         exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_abc88a5113c02b55942862ef39b30ec80}{exportSolutionOnFractures}(myrmesh, ss.str(), \textcolor{keyword}{dynamic\_cast<}
      \hyperlink{classFVCode3D_1_1DarcyPseudoSteady}{PseudoDarcyPb} *\textcolor{keyword}{>}(darcy)->getOldSolution());
00247         std::cout << \textcolor{stringliteral}{"  done."} << std::endl << std::endl;
00248 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00249 
00250         ++iter;
00251 
00252         \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} t = dataPtr->getInitialTime() + dataPtr->getTimeStep() ; t <= dataPtr->getEndTime(); t
      +=dataPtr->getTimeStep(), ++iter)
00253         \{
00254             std::cout << \textcolor{stringliteral}{" ... at t = "} << t << \textcolor{stringliteral}{" ..."} << std::endl;
00255             darcy->\hyperlink{classFVCode3D_1_1Problem_aa3f0a44084a56374f5ac7f242e0e45f7}{assemble}();
00256             \textcolor{keywordflow}{if}(dataPtr->pressuresInFractures())
00257             \{
00258                 \hyperlink{classFVCode3D_1_1FixPressureDofs}{FixPressureDofs<PseudoDarcyPb>} fpd(dynamic\_cast<PseudoDarcyPb
       *>(darcy));
00259                 fpd.\hyperlink{classFVCode3D_1_1FixPressureDofs_a3393776b99ad339672ba99cfc5c200e2}{apply}(dataPtr->getPressuresInFractures());
00260             \}
00261             darcy->\hyperlink{classFVCode3D_1_1Problem_a7ee30db5a251dc7a9778c821e49cf376}{solve}();
00262 
00263             \textcolor{keywordflow}{if}(dynamic\_cast<IterativeSolver*>(&(darcy->\hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}())))
00264             \{
00265                 std::cout << std::endl;
00266                 std::cout << \textcolor{stringliteral}{"\(\backslash\)t# iterations: "} << \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->
      \hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->getIter() << std::endl;
00267                 std::cout << \textcolor{stringliteral}{"\(\backslash\)tResidual: "} << \textcolor{keyword}{dynamic\_cast<}\hyperlink{classFVCode3D_1_1IterativeSolver}{IterativeSolver}*\textcolor{keyword}{>}(darcy->
      \hyperlink{classFVCode3D_1_1Problem_a24f0f7e726e4c68a0eac87a4a4054823}{getSolverPtr}())->getResidual() << std::endl;
00268                 std::cout << std::endl;
00269             \}
00270 
00271 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00272             ss.str(std::string());
00273             std::cout << \textcolor{stringliteral}{" Export Solution"} << std::flush;
00274             ss << dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_"};
00275             ss << iter;
00276             ss << \textcolor{stringliteral}{".vtu"};
00277             exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a476a1dd02bcba8c31f0d99c7106d0c21}{exportSolution}(myrmesh, ss.str(), darcy->
      \hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}());
00278             ss.str(std::string());
00279             ss << dataPtr->getOutputDir() + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_f\_"};
00280             ss << iter;
00281             ss << \textcolor{stringliteral}{".vtu"};
00282             exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_abc88a5113c02b55942862ef39b30ec80}{exportSolutionOnFractures}(myrmesh, ss.str(), darcy->
      \hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}());
00283             std::cout << \textcolor{stringliteral}{"  done."} << std::endl << std::endl;
00284 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00285         \}
00286     \}
00287     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00288 
00289     \textcolor{keywordflow}{if}(dataPtr->MSROn())
00290     \{
00291         std::cout << \textcolor{stringliteral}{"Compute sub-regions..."} << std::flush;
00292         multipleSubRegions->\hyperlink{classFVCode3D_1_1MSR_af28b461584648e7d01bc515944ff42e8}{createRegions}();
00293         std::cout << \textcolor{stringliteral}{" done."} << std::endl;
00294         std::cout << \textcolor{stringliteral}{"Compute transmissibilities..."} << std::flush;
00295         multipleSubRegions->\hyperlink{classFVCode3D_1_1MSR_a86a998e349b36dbbef9300b15653afc2}{computeTransmissibility}();
00296         std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00297     \}
00298 
00299     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00300     
00301     
00302     \textcolor{keywordflow}{if}(dataPtr->getNumericalMethodType() == \hyperlink{classFVCode3D_1_1Data_a5222e1901276af4586befd821445c6cfacf4497fa0025d2f6ea6a9b682e384ff3}{Data::MFD})\{
00303                 \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} numFacetsTot   = myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_a6d3cdd4ef8a5225599953179d5302636}{getFacetsVector}().size() + myrmesh.
      \hyperlink{classFVCode3D_1_1Rigid__Mesh_aadbe6d9ad704122537903396d91238e0}{getFractureFacetsIdsVector}().size();
00304                 \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} numCellsTot    = myrmesh.\hyperlink{classFVCode3D_1_1Rigid__Mesh_afefb62f2c37317402b495e2369ed495b}{getCellsVector}().size() + myrmesh.
      \hyperlink{classFVCode3D_1_1Rigid__Mesh_aadbe6d9ad704122537903396d91238e0}{getFractureFacetsIdsVector}().size();
00305                 std::cout << \textcolor{stringliteral}{"Export Solution..."} << std::flush;
00306                 exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a476a1dd02bcba8c31f0d99c7106d0c21}{exportSolution}( myrmesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_solution.vtu"}, 
00307                         darcy->\hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}().segment(numFacetsTot,
      numCellsTot) );
00308                 std::cout << \textcolor{stringliteral}{"Export Solution on Fractures..."} << std::flush;
00309                 exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_abc88a5113c02b55942862ef39b30ec80}{exportSolutionOnFractures}( myrmesh, dataPtr->getOutputDir
      () + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_f.vtu"}, 
00310                         darcy->\hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}().segment(numFacetsTot,
      numCellsTot) );
00311                 std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00312         \}
00313             
00314     \textcolor{keywordflow}{else}\{
00315                 std::cout << \textcolor{stringliteral}{"Export Solution..."} << std::flush;
00316                 exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a476a1dd02bcba8c31f0d99c7106d0c21}{exportSolution}(myrmesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_solution.vtu"}, darcy->\hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}());
00317                 std::cout << \textcolor{stringliteral}{"Export Solution on Fractures..."} << std::flush;
00318                 exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_abc88a5113c02b55942862ef39b30ec80}{exportSolutionOnFractures}(myrmesh, dataPtr->getOutputDir(
      ) + dataPtr->getOutputFile() + \textcolor{stringliteral}{"\_solution\_f.vtu"},
00319         darcy->\hyperlink{classFVCode3D_1_1Problem_a39e64d24161ea699046d4e670fbc4eab}{getSolver}().\hyperlink{classFVCode3D_1_1Solver_a461d049e52ffc237cce3447c82860d3c}{getSolution}());
00320         std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00321         \}
00322 
00323 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00324     \textcolor{keywordflow}{if}(dataPtr->MSROn())
00325     \{
00326         std::cout << \textcolor{stringliteral}{"Export SubRegions..."} << std::flush;
00327         exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a476a1dd02bcba8c31f0d99c7106d0c21}{exportSolution}(myrmesh, dataPtr->getOutputDir() + dataPtr->getOutputFile() +
       \textcolor{stringliteral}{"\_colour.vtu"},
00328     multipleSubRegions->\hyperlink{classFVCode3D_1_1MSR_a45eca62b8bdf376a08c668b1535ac275}{getColorsVector}() );
00329         std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00330     \}
00331 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00332 
00333     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00334 
00335 \textcolor{preprocessor}{#ifdef FVCODE3D\_EXPORT}
00336     std::cout << \textcolor{stringliteral}{"Export Property..."} << std::flush;
00337     exporter.\hyperlink{classFVCode3D_1_1ExporterVTU_a12240c4de9e7b3a5bf8f513c873c4547}{exportWithProperties}(myrmesh, dataPtr->getOutputDir() + dataPtr->
      getOutputFile() + \textcolor{stringliteral}{"\_APP.vtu"}, \hyperlink{namespaceFVCode3D_ab3abc77722284ce4344be90bb61c1a41a7bea6d441c4661b396fc86912312c47e}{Aperture} | \hyperlink{namespaceFVCode3D_ab3abc77722284ce4344be90bb61c1a41a23fa3ea40f896b28978ffc259e5281cf}{Permeability} | \hyperlink{namespaceFVCode3D_ab3abc77722284ce4344be90bb61c1a41a8bb92532e203b2a2b45c4b2ce0354a90}{Porosity});
00338     std::cout << \textcolor{stringliteral}{" done."} << std::endl << std::endl;
00339 
00340     std::cout << \textcolor{stringliteral}{"Passed seconds: "} << chrono.\hyperlink{classFVCode3D_1_1Chrono_a245a0c47da85e80de56e85d3689b925b}{partial}() << \textcolor{stringliteral}{" s."} << std::endl << std::endl;
00341 \textcolor{preprocessor}{#endif // FVCODE3D\_EXPORT}
00342 
00343     \textcolor{keyword}{delete} darcy;
00344     \textcolor{keyword}{delete} importer;
00345 
00346     chrono.\hyperlink{classFVCode3D_1_1Chrono_acc8f31330aa1819b12947866075fbc9e}{stop}();
00347 
00348     \textcolor{keywordflow}{return} 0;
00349 \}
\end{DoxyCode}
