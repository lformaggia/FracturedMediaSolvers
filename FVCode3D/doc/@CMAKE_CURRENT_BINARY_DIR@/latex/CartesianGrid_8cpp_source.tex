\hypertarget{CartesianGrid_8cpp_source}{}\section{Cartesian\+Grid.\+cpp}
\label{CartesianGrid_8cpp_source}\index{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/mesh/\+Cartesian\+Grid.\+cpp@{/home/corinne/eni\+Reservoir\+G\+I\+T\+H\+U\+B/eni\+Reservoir/\+F\+V\+Code3\+D/src/\+F\+V\+Code3\+D/mesh/\+Cartesian\+Grid.\+cpp}}

\begin{DoxyCode}
00001 
00006 \textcolor{preprocessor}{#include <\hyperlink{Mesh3D_8hpp}{FVCode3D/mesh/Mesh3D.hpp}>}
00007 \textcolor{preprocessor}{#include <\hyperlink{Properties_8hpp}{FVCode3D/property/Properties.hpp}>}
00008 \textcolor{preprocessor}{#include <\hyperlink{CartesianGrid_8hpp}{FVCode3D/mesh/CartesianGrid.hpp}>}
00009 \textcolor{preprocessor}{#include <\hyperlink{MeshUtility_8hpp}{FVCode3D/mesh/MeshUtility.hpp}>}
00010 
00011 \textcolor{keyword}{namespace }\hyperlink{namespaceFVCode3D}{FVCode3D}
00012 \{
00013 
00014 \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1CartesianGrid_afdc4d12f34f9bf46db17ec8765e6875f}{CartesianGrid::}
\hypertarget{CartesianGrid_8cpp_source.tex_l00015}{}\hyperlink{classFVCode3D_1_1CartesianGrid_afdc4d12f34f9bf46db17ec8765e6875f}{00015} \hyperlink{classFVCode3D_1_1CartesianGrid_afdc4d12f34f9bf46db17ec8765e6875f}{generate}( \textcolor{keywordtype}{bool} fracturesOn,
00016           \textcolor{keyword}{const} std::function<\hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real}(\textcolor{keyword}{const} \hyperlink{classFVCode3D_1_1Point3D}{Point3D}&)> & \_surface )
00017 \{
00018     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Lx = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getLx();
00019     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Ly = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getLy();
00020 \textcolor{comment}{//    const Real Lz = M\_data->getLz();}
00021     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Nx = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNx();
00022     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Ny = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNy();
00023     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Nz = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNz();
00024     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Sx = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getSx();
00025     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Sy = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getSy();
00026     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Sz = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getSz();
00027     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Rz = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getRz() / 180. * \hyperlink{namespaceFVCode3D_a10917df7e49a48239ce5f00ec9bbfe0a}{\_PI\_};
00028     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} noise = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->noiseOn();
00029     \textcolor{keyword}{const} \hyperlink{classFVCode3D_1_1Data_a983fdc14aa355a7c9fd614b9655a3552}{Data::NoiseOn} noiseOn = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNoiseOn();
00030     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} mean = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getMeanNormalDistribution();
00031     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} stDev = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getStDevNormalDistribution(); \textcolor{comment}{// 5.0e-2  7.5e-3 , 3.75e-3 ,
       1.875e-3 , 9.375e-4}
00032 
00033     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} hx = Lx/Nx;
00034     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} hy = Ly/Ny;
00035 \textcolor{comment}{//    Real hz = Lz/Nz;}
00036     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} nNodes = (Nx+1)*(Ny+1)*(Nz+1);
00037     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i,j,k;
00038 
00039     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} bcId, zone, maxZone = 0, count = 0;
00040 
00041     std::vector<UInt> tmp, tmpFacets;
00042 
00043     std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00044     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00045     std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00046 
00047     nodesRef.reserve(nNodes);
00048 
00049     \textcolor{comment}{// create nodes}
00050     \textcolor{keywordflow}{for}(k=0; k <= Nz; ++k)
00051     \{
00052         \textcolor{keywordflow}{for}(j=0; j <= Ny; ++j)
00053         \{
00054             \textcolor{keywordflow}{for}(i=0; i <= Nx; ++i)
00055             \{
00056                 \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} abscissa = hx*i*cos(Rz) - hy*j*sin(Rz) + Sx;
00057                 \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} ordinate = hx*i*sin(Rz) + hy*j*cos(Rz) + Sy;
00058                 \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} Lz = \_surface( \hyperlink{classFVCode3D_1_1Point3D}{Point3D}( abscissa, ordinate, 0. ) );
00059                 \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} quota = Lz/Nz*k + Sz;
00060                 nodesRef.emplace\_back( abscissa, ordinate, quota ); \textcolor{comment}{// Point3D}
00061             \}
00062         \}
00063     \}
00064 
00065     \textcolor{keywordflow}{if}(noise && (noiseOn == \hyperlink{classFVCode3D_1_1Data_a983fdc14aa355a7c9fd614b9655a3552ab1c94ca2fbc3e78fc30069c8d0f01680}{Data::NoiseOn::All}))
00066     \{
00067         \hyperlink{namespaceFVCode3D_a9f604a7093f7f7323727e7ba28d8ce75}{addNoiseToPoint}(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, mean, stDev);
00068     \}
00069 
00070     tmp.resize(4);
00071 
00072     \textcolor{comment}{// create facets parallel to x axis}
00073     \textcolor{keywordflow}{for}(i=0; i <= Nx; ++i)
00074     \{
00075         \textcolor{keywordflow}{for}(k=0; k < Nz; ++k)
00076         \{
00077             \textcolor{keywordflow}{for}(j=0; j < Ny; ++j)
00078             \{
00079                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00080                 tmp[1] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00081                 tmp[2] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00082                 tmp[3] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00083 
00084                 bcId = ((i == 0) || (i == Nx)) ? 1 : 0;
00085                 zone = 0;
00086 
00087                 facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(count), 
      std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, tmp, (zone)*static\_cast<UInt>(fracturesOn), bcId) );
00088                 ++count;
00089             \}
00090         \}
00091     \}
00092 
00093     \textcolor{comment}{// create facets parallel to y axis}
00094     \textcolor{keywordflow}{for}(j=0; j <= Ny; ++j)
00095     \{
00096         \textcolor{keywordflow}{for}(i=0; i < Nx; ++i)
00097         \{
00098             \textcolor{keywordflow}{for}(k=0; k < Nz; ++k)
00099             \{
00100                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00101                 tmp[1] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00102                 tmp[2] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00103                 tmp[3] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00104 
00105                 bcId = (( j==0 ) || (j == Ny)) ? 1 : 0;
00106                 zone = 0;
00107 
00108                 facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(count), 
      std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, tmp, (zone)*static\_cast<UInt>(fracturesOn), bcId) );
00109                 ++count;
00110             \}
00111         \}
00112     \}
00113 
00114     \textcolor{comment}{// create facets parallel to z axis}
00115     \textcolor{keywordflow}{for}(k=0; k <= Nz; ++k)
00116     \{
00117         \textcolor{keywordflow}{for}(j=0; j < Ny; ++j)
00118         \{
00119             \textcolor{keywordflow}{for}(i=0; i < Nx; ++i)
00120             \{
00121                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00122                 tmp[1] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00123                 tmp[2] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00124                 tmp[3] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00125 
00126                 bcId = ((k == 0) || (k == Nz)) ? 1 : 0;
00127                 zone = 0;
00128 
00129                 facetsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(count), 
      std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, tmp, (zone)*static\_cast<UInt>(fracturesOn), bcId) );
00130                 ++count;
00131             \}
00132         \}
00133     \}
00134 
00135     tmpFacets.resize(6);
00136 
00137     count = 0;
00138 
00139     \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a609f980329f5a98e9fad724049e509d2}{buildNodesToFacetMap}();
00140 
00141     \textcolor{comment}{// create cells}
00142     \textcolor{keywordflow}{for}(k=0; k < Nz; ++k)
00143     \{
00144         \textcolor{keywordflow}{for}(j=0; j < Ny; ++j)
00145         \{
00146             \textcolor{keywordflow}{for}(i=0; i < Nx; ++i)
00147             \{
00148                 \textcolor{comment}{// bottom}
00149                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00150                 tmp[1] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00151                 tmp[2] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00152                 tmp[3] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00153 
00154                 tmpFacets[0] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00155 
00156                 \textcolor{comment}{// top}
00157                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00158                 tmp[1] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00159                 tmp[2] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00160                 tmp[3] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00161 
00162                 tmpFacets[1] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00163 
00164                 \textcolor{comment}{// left}
00165                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00166                 tmp[1] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00167                 tmp[2] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00168                 tmp[3] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00169 
00170                 tmpFacets[2] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00171 
00172                 \textcolor{comment}{// right}
00173                 tmp[0] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00174                 tmp[1] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00175                 tmp[2] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00176                 tmp[3] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00177 
00178                 tmpFacets[3] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00179 
00180                 \textcolor{comment}{// back}
00181                 tmp[0] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00182                 tmp[1] = i + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00183                 tmp[2] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00184                 tmp[3] = i + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00185 
00186                 tmpFacets[4] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00187 
00188                 \textcolor{comment}{// front}
00189                 tmp[0] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * k;
00190                 tmp[1] = i+1 + (Nx+1) * j + (Nx+1)*(Ny+1) * (k+1);
00191                 tmp[2] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * (k+1);
00192                 tmp[3] = i+1 + (Nx+1) * (j+1) + (Nx+1)*(Ny+1) * k;
00193 
00194                 tmpFacets[5] = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a2ac0b84c13a15ed42cdd8c98066eae98}{getFacetFromNodes}(tmp);
00195 
00196                 cellsRef.emplace( std::piecewise\_construct, std::forward\_as\_tuple(count), 
      std::forward\_as\_tuple(&\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, tmpFacets, maxZone+1) );
00197 
00198                 ++count;
00199             \}
00200         \}
00201     \}
00202 \}
00203 
\hypertarget{CartesianGrid_8cpp_source.tex_l00204}{}\hyperlink{classFVCode3D_1_1CartesianGrid_a8e96033c8f0f0f7b326bba2a87a20c41}{00204} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1CartesianGrid_a8e96033c8f0f0f7b326bba2a87a20c41}{CartesianGrid::extractBC}(\textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} theta)
00205 \{
00206     \hyperlink{classFVCode3D_1_1Point3D}{Point3D} normal, center, centerFace;
00207     \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} max;
00208     \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} compMax;
00209 
00210     \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Facet3D>::iterator it = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().begin(); it 
      != \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}().end(); ++it)
00211     \{
00212         \textcolor{keywordflow}{if} (it->second.getSeparatedCells().size() == 1)
00213         \{
00214             center = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}().at(*(it->second.getSeparatedCells().begin())).
      getCentroid();
00215             centerFace = it->second.getCentroid();
00216 
00217             normal = it->second.getUnsignedNormal();
00218             center -= centerFace;
00219             center.\hyperlink{classFVCode3D_1_1Point3D_a0d1cd3d114b0985ae2b11cd1c52de673}{normalize}();
00220 
00221             \textcolor{keywordflow}{if}(normal * center > 0.)
00222                 normal = -normal;
00223 
00224             normal = \hyperlink{namespaceFVCode3D_aefa056e4f7c5d10edd993b812dd670da}{rotateOf}(normal, theta);
00225 
00226             max = std::max(std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_ae015d6aa31f8b304f69696bdcbd4da19}{x}()), std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a950abcabbf3bb32fc2daf64c28d77416}{y}()));
00227             compMax = std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_ae015d6aa31f8b304f69696bdcbd4da19}{x}()) > std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a950abcabbf3bb32fc2daf64c28d77416}{y}()) ? 0 : 1;
00228 
00229             max = std::max(max, std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a865109e2006cc1de3681ab601081f5aa}{z}()));
00230             compMax = max > std::fabs(normal.\hyperlink{classFVCode3D_1_1Point3D_a865109e2006cc1de3681ab601081f5aa}{z}()) ? compMax : 2;
00231 
00232             \textcolor{keywordflow}{if}(normal[compMax]>0.)
00233                 it->second.setBorderID(2*compMax+1);
00234             \textcolor{keywordflow}{else}
00235                 it->second.setBorderID(2*compMax+2);
00236         \}
00237     \}
00238 \}
00239 
\hypertarget{CartesianGrid_8cpp_source.tex_l00240}{}\hyperlink{classFVCode3D_1_1CartesianGrid_ad331317a639d3441d6fa7707b78dfc67}{00240} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1CartesianGrid_ad331317a639d3441d6fa7707b78dfc67}{CartesianGrid::addFractures}(\textcolor{keyword}{const} std::map<UInt,UInt> & facetIdToZone)
00241 \{
00242     std::map<UInt, Mesh3D::Facet3D> & facetsRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a76de387da2a552e3e1210d795bc7acf9}{getFacetsMap}();
00243 
00244     \hyperlink{classFVCode3D_1_1FractureNetwork3D}{FractureNetwork3D} FN(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh});
00245     std::vector<Fracture3D> fracturesVector;
00246     std::map<UInt, Fracture3D> fracturesMap;
00247     std::map<UInt, Fracture3D>::iterator itF;
00248     \hyperlink{classFVCode3D_1_1Point3D}{Point3D} normal, center, centerFace;
00249     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Nx = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNx();
00250     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Ny = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNy();
00251     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} Nz = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNz();
00252     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} noise = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->noiseOn();
00253     \textcolor{keyword}{const} \hyperlink{classFVCode3D_1_1Data_a983fdc14aa355a7c9fd614b9655a3552}{Data::NoiseOn} noiseOn = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getNoiseOn();
00254     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} mean = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getMeanNormalDistribution();
00255     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} stDev = \hyperlink{classFVCode3D_1_1CartesianGrid_a8548798ae1d2a011869ed314a1ebb8f3}{M\_data}->getStDevNormalDistribution();
00256 
00257     \textcolor{keywordflow}{for}(std::map<UInt,UInt>::const\_iterator it = facetIdToZone.begin(); it!= facetIdToZone.end(); ++it)
00258         \textcolor{keywordflow}{if}(facetsRef.find(it->first) != facetsRef.end())
00259             facetsRef[it->first].setZoneCode(it->second);
00260 
00261     \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Facet3D>::iterator it = facetsRef.begin(); it != facetsRef.end(); ++it)
00262     \{
00263         \textcolor{keywordflow}{if} (it->second.getZoneCode() > 0 && it->second.getBorderId()==0)
00264         \{
00265             itF = fracturesMap.find(it->second.getZoneCode());
00266             \textcolor{keywordflow}{if} (itF != fracturesMap.end())
00267                 itF->second.push\_back(it->first);
00268             \textcolor{keywordflow}{else}
00269             \{
00270                 fracturesMap.emplace(std::piecewise\_construct, std::forward\_as\_tuple(it->second.getZoneCode
      ()), std::forward\_as\_tuple(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}) );
00271                 fracturesMap.at(it->second.getZoneCode()).push\_back(it->first);
00272                 fracturesMap.at(it->second.getZoneCode()).getId() = it->second.getZoneCode();
00273             \}
00274         \}
00275     \}
00276 
00277     fracturesVector.reserve(fracturesMap.size());
00278     \textcolor{keywordflow}{for}(itF = fracturesMap.begin();  itF != fracturesMap.end(); ++itF)
00279         fracturesVector.push\_back(itF->second);
00280 
00281     FN.\hyperlink{classFVCode3D_1_1FractureNetwork3D_a1d1ae862d9076988686cef213dc0574d}{addFractures}(fracturesVector);
00282 
00283     \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a269c01796091da2f599e66b6b91b39dd}{addFractureNetwork}(FN);
00284 
00285     \textcolor{keywordflow}{if}(noise && (noiseOn != \hyperlink{classFVCode3D_1_1Data_a983fdc14aa355a7c9fd614b9655a3552ab1c94ca2fbc3e78fc30069c8d0f01680}{Data::NoiseOn::All}))
00286     \{
00287         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} initVal = (noiseOn == \hyperlink{classFVCode3D_1_1Data_a983fdc14aa355a7c9fd614b9655a3552af53df0293e169f562bc1d9a20e1d2589}{Data::NoiseOn::Matrix}) ? \textcolor{keyword}{true} : \textcolor{keyword}{false};
00288         \textcolor{keyword}{const} \textcolor{keywordtype}{bool} setVal = !initVal;
00289         std::vector<Point3D> & nodesRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_a04162ec60e0fe52674b3ecbb7de1185c}{getNodesVector}();
00290         std::map<UInt, Mesh3D::Cell3D> & cellsRef = \hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}.\hyperlink{classFVCode3D_1_1Mesh3D_ad904ef5e068c89951d77e9364e960bf3}{getCellsMap}();
00291         std::vector<bool> nodesWithNoise( nodesRef.size(), initVal );
00292         std::array<UInt,2> Cx=\{\{0,Nx\}\};
00293         std::array<UInt,2> Cy=\{\{0,Ny\}\};
00294         std::array<UInt,2> Cz=\{\{0,Nz\}\};
00295 
00296         \textcolor{keywordflow}{for}(std::map<UInt, Fracture3D>::iterator it = fracturesMap.begin(); it != fracturesMap.end(); ++it)
00297         \{
00298             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} facetId : it->second.getFractureFacetsId() )
00299             \{
00300                 \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} nodeId : facetsRef[facetId].getVerticesVector())
00301                 \{
00302                     nodesWithNoise[nodeId] = setVal;
00303                 \}
00304             \}
00305         \}
00306 
00307         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i : Cx)
00308         \{
00309             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} j : Cy)
00310             \{
00311                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} k=0; k <= Nz; ++k)
00312                 \{
00313                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00314                     nodesWithNoise[index] = \textcolor{keyword}{false};
00315                 \}
00316             \}
00317             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} k : Cz)
00318             \{
00319                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=0; j <= Ny; ++j)
00320                 \{
00321                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00322                     nodesWithNoise[index] = \textcolor{keyword}{false};
00323                 \}
00324             \}
00325         \}
00326         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} j : Cy)
00327         \{
00328             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} k : Cz)
00329             \{
00330                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i=0; i <= Nx; ++i)
00331                 \{
00332                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00333                     nodesWithNoise[index] = \textcolor{keyword}{false};
00334                 \}
00335             \}
00336         \}
00337 
00338         std::vector<bool> nodesWithNoiseX( nodesRef.size(), false );
00339         std::vector<bool> nodesWithNoiseY( nodesRef.size(), false );
00340         std::vector<bool> nodesWithNoiseZ( nodesRef.size(), false );
00341 
00342         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} i : Cx)
00343         \{
00344             \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=1; j < Ny; ++j)
00345             \{
00346                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} k=1; k < Nz; ++k)
00347                 \{
00348                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00349                     nodesWithNoiseX[index] = nodesWithNoise[index];
00350                     nodesWithNoise[index] = \textcolor{keyword}{false};
00351                 \}
00352             \}
00353         \}
00354         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} j : Cy)
00355         \{
00356             \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i=1; i < Nx; ++i)
00357             \{
00358                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} k=1; k < Nz; ++k)
00359                 \{
00360                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00361                     nodesWithNoiseY[index] = nodesWithNoise[index];
00362                     nodesWithNoise[index] = \textcolor{keyword}{false};
00363                 \}
00364             \}
00365         \}
00366         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} k : Cz)
00367         \{
00368             \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} i=1; i < Nx; ++i)
00369             \{
00370                 \textcolor{keywordflow}{for}(\hyperlink{namespaceFVCode3D_a4bf7e328c75d0fd504050d040ebe9eda}{UInt} j=1; j < Ny; ++j)
00371                 \{
00372                     \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} index = i + (Nx+1) * j + (Nx+1) * (Ny+1) * k;
00373                     nodesWithNoiseZ[index] = nodesWithNoise[index];
00374                     nodesWithNoise[index] = \textcolor{keyword}{false};
00375                 \}
00376             \}
00377         \}
00378 
00379         \hyperlink{namespaceFVCode3D_a9f604a7093f7f7323727e7ba28d8ce75}{addNoiseToPoint}(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, nodesWithNoise, mean, stDev);
00380         \hyperlink{namespaceFVCode3D_a9f604a7093f7f7323727e7ba28d8ce75}{addNoiseToPoint}(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, nodesWithNoiseX, std::vector<UInt>\{1,2\}, mean, stDev);
00381         \hyperlink{namespaceFVCode3D_a9f604a7093f7f7323727e7ba28d8ce75}{addNoiseToPoint}(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, nodesWithNoiseY, std::vector<UInt>\{0,2\}, mean, stDev);
00382         \hyperlink{namespaceFVCode3D_a9f604a7093f7f7323727e7ba28d8ce75}{addNoiseToPoint}(\hyperlink{classFVCode3D_1_1CartesianGrid_a40c64e663b3d2de02b852403c75495fb}{M\_mesh}, nodesWithNoiseZ, std::vector<UInt>\{0,1\}, mean, stDev);
00383 
00384         \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Facet3D>::iterator it = facetsRef.begin(); it != facetsRef.end(); ++it)
00385         \{
00386             it->second.computeCentroidAndNormalAndArea();
00387         \}
00388 
00389         \textcolor{keywordflow}{for}(std::map<UInt, Mesh3D::Cell3D>::iterator it = cellsRef.begin(); it != cellsRef.end(); ++it)
00390         \{
00391             it->second.computeVolumeAndCentroid();
00392         \}
00393     \}
00394 \}
00395 
\hypertarget{CartesianGrid_8cpp_source.tex_l00396}{}\hyperlink{classFVCode3D_1_1CartesianGrid_ac8dc7df2cf0ff329b495db228c58002b}{00396} \textcolor{keywordtype}{void} \hyperlink{classFVCode3D_1_1CartesianGrid_ac8dc7df2cf0ff329b495db228c58002b}{CartesianGrid::addBCAndFractures}(\textcolor{keyword}{const} std::map<UInt,UInt> & 
      facetIdToZone, \textcolor{keyword}{const} \hyperlink{namespaceFVCode3D_a40c1f5588a248569d80aa5f867080e83}{Real} theta)
00397 \{
00398     \hyperlink{classFVCode3D_1_1CartesianGrid_a8e96033c8f0f0f7b326bba2a87a20c41}{extractBC}(theta);
00399     \hyperlink{classFVCode3D_1_1CartesianGrid_ad331317a639d3441d6fa7707b78dfc67}{addFractures}(facetIdToZone);
00400 \}
00401 
00402 \} \textcolor{comment}{// namespace FVCode3D}
\end{DoxyCode}
